/*! For license information please see system.js.LICENSE.txt */
!function(){"use strict";var e={532:function(e,t,a){var n=a(601),i=a.n(n),r=a(314),s=a.n(r)()(i());s.push([e.id,'.app{color:#fff}.window-app .window-content,#chat-log .message,#chat-form textarea,#chat-controls div.roll-type-select select,.sidebar-tab .directory-header .header-search input,#chat-form .cm-s-easymde{background:#f1f2f6;color:var(--fatex-primary-text-color, #191813)}#chat-log .message.whisper{opacity:.8}@font-face{font-family:"Montserrat";src:url("/systems/fatex/assets/fonts/Montserrat-Regular.otf")}@font-face{font-family:"Montserrat";src:url("/systems/fatex/assets/fonts/Montserrat-Italic.otf");font-style:italic}@font-face{font-family:"Montserrat";src:url("/systems/fatex/assets/fonts/Montserrat-Light.otf");font-weight:300}@font-face{font-family:"Montserrat";src:url("/systems/fatex/assets/fonts/Montserrat-LightItalic.otf");font-style:italic;font-weight:300}@font-face{font-family:"Montserrat";src:url("/systems/fatex/assets/fonts/Montserrat-Bold.otf");font-weight:bold}@font-face{font-family:"Montserrat";src:url("/systems/fatex/assets/fonts/Montserrat-BoldItalic.otf");font-style:italic;font-weight:bold}@font-face{font-family:"Montserrat";src:url("/systems/fatex/assets/fonts/Montserrat-Black.otf");font-weight:900}@font-face{font-family:"Montserrat";src:url("/systems/fatex/assets/fonts/Montserrat-BlackItalic.otf");font-style:italic;font-weight:900}@font-face{font-family:"Fate Icons";src:url("/systems/fatex/assets/fonts/fate_icons.ttf")}#chat-log{font-family:"Montserrat",sans-serif}body{text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fatex-actions{position:absolute;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;gap:10px;height:100%;text-shadow:1px 1px 2px #a0a0a0;pointer-events:none;z-index:4}.fatex-actions--automation-item{right:20px;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.fatex-actions--automation-item .fatex-actions__icon{font-size:14px}.fatex-actions--headline,.fatex-actions--setting,.fatex-actions--skill{right:15px;padding:0 10px 0 50px;top:0;background:rgba(0,0,0,0)}.fatex-actions--item{top:-10px}.fatex-actions--item,.fatex-actions--section-heading{right:0;padding-left:50px;font-size:18px}.fatex-actions--section-heading{top:5px}.fatex-actions--skill{right:0}.fatex-actions--setting{padding-left:10px;cursor:pointer;pointer-events:initial}.fatex-actions--skill-secondary{left:-15px;top:20px;gap:0;font-size:16px;color:var(--fatex-primary-color, rgb(47, 53, 66));text-shadow:1px -1px 1px #f1f2f6}.fatex-actions__icon{cursor:pointer;opacity:0}.fatex-actions__icon--no-hide{opacity:1;pointer-events:all}.fatex-actions__icon--move{cursor:move}.fatex-actions__icon--reverse{-webkit-transform:rotate(180deg);transform:rotate(180deg);text-shadow:-1px -1px 2px #a0a0a0}.fatex-actions__icon--secondary{font-family:"Fate Icons",sans-serif}.fatex-actions__text{font-size:12px}.fatex-js-edit-mode .fatex-actions--headline,.fatex-js-edit-mode .fatex-actions--skill{background:-webkit-gradient(linear, left top, right top, from(rgba(47, 53, 66, 0)), color-stop(33%, #2f3542), to(#2f3542));background:linear-gradient(90deg, rgba(47, 53, 66, 0) 0%, #2f3542 33%, #2f3542 100%)}.fatex-js-edit-mode .fatex-actions--item,.fatex-js-edit-mode .fatex-actions--section-heading{background:-webkit-gradient(linear, left top, right top, from(rgba(241, 242, 246, 0)), color-stop(33%, rgb(241, 242, 246)), to(rgb(241, 242, 246)));background:linear-gradient(90deg, rgba(241, 242, 246, 0) 0%, rgb(241, 242, 246) 33%, rgb(241, 242, 246) 100%)}.fatex-js-edit-mode .fatex-actions__icon{opacity:1;pointer-events:all}.fatex__actor_group__sheet{height:100%;max-height:100%;display:grid;grid-template-columns:1fr;grid-template-rows:minmax(100px, 100%) -webkit-min-content;grid-template-rows:minmax(100px, 100%) min-content;grid-template-areas:"content" "footer"}.fatex__actor_group__sheet .fatex__actor_group__sheet__content{grid-area:content;overflow-y:auto}.fatex__actor_group__sheet .fatex__actor_group__sheet__navigation{grid-area:footer;z-index:10;padding:5px;-webkit-box-shadow:0 -2px 15px 0 var(--fatex-primary-color, rgb(47, 53, 66));box-shadow:0 -2px 15px 0 var(--fatex-primary-color, rgb(47, 53, 66))}.fatex__actor_group__settings{display:none}.actor_group_overview .window-resizable-handle{z-index:20}.fatex__actor_group__sheet__navigation a{display:inline-block;color:var(--fatex-primary-color, rgb(47, 53, 66));padding:5px 20px 5px 20px;position:relative;font-weight:bold;text-transform:uppercase;font-size:13px;-webkit-box-shadow:1px 1px 1px #a0a0a0;box-shadow:1px 1px 1px #a0a0a0}.fatex__actor_group__sheet__navigation a.active,.fatex__actor_group__sheet__navigation a:hover{background:var(--fatex-primary-color, rgb(47, 53, 66));color:#fff}.fatex__actorDirectory__entry{-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.fatex__actorDirectory__entry i{-webkit-box-flex:0;-webkit-flex:0 0 24px;-ms-flex:0 0 24px;flex:0 0 24px}li.folder>.folder-header .create-folder-group{-webkit-box-flex:0;-webkit-flex:0 0 20px;-ms-flex:0 0 20px;flex:0 0 20px;text-align:center;color:#ccc;font-size:14px;padding-left:5px}.actor_group_panel__group__images{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;margin:0 8px 0 2px;-webkit-box-flex:0;-webkit-flex:0 0 48px;-ms-flex:0 0 48px;flex:0 0 48px}.sidebar-tab .directory-list .directory-item .actor_group_panel__group__image{margin:0;height:24px;width:24px;-webkit-box-flex:0;-webkit-flex:0;-ms-flex:0;flex:0}.fatex-sheet-setup{padding:10px;min-width:100%}.fatex-sheet-setup__group{width:50%;min-width:180px}.fatex-sheet-setup__group:only-child,.fatex-sheet-setup__group--columns{width:100%}.fatex-sheet-setup__group-label{position:relative;display:block;margin-bottom:10px;font-size:10px;font-weight:bold;text-transform:uppercase;cursor:pointer}.fatex-sheet-setup__groups{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:10px;padding:10px}.fatex-sheet-setup__main{margin-top:40px}.fatex-sheet-setup__option{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.fatex-sheet-setup__options{display:grid;gap:10px}.fatex-sheet-setup__options--columns{grid-template-columns:repeat(2, 1fr)}.fatex-sheet-setup__options--columns .fatex-sheet-setup__option{page-break-inside:avoid}.fatex-sheet-setup__section{margin-bottom:20px}.fatex-setup-actions{display:grid;grid-template:1fr 1fr/repeat(3, 1fr);grid-template-areas:"x x r" "x x r";gap:5px}.fatex-option-checkbox{position:absolute;opacity:0;left:-10000px;top:-10000px}.fatex-option-checkbox__box{display:inline-block;width:16px;height:16px;border:1px solid var(--fatex-primary-color, rgb(47, 53, 66));border-radius:3px;margin-right:10px;color:var(--fatex-light-text-color, #fff);font-size:11px;text-align:center}.fatex-option-checkbox:checked+.fatex-option-checkbox__box{background:var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-option-checkbox:checked+.fatex-option-checkbox__box:before{content:"";font-weight:900;font-family:"Font Awesome 5 Free";display:inline-block;font-style:normal;font-variant:normal;text-rendering:auto;line-height:1;-webkit-font-smoothing:antialiased}.fatex-templates{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;height:100%;min-width:100%;gap:10px;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.fatex-templates--empty{-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.fatex-templates--min{min-height:375px}.fatex-template{min-width:200px}.fatex-template__actions{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:5px}.fatex-template__help{font-size:12px;text-align:center}.fatex-template__help-button{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;white-space:nowrap;cursor:pointer}.fatex-template__help-text{margin:20px}.fatex-template__image{height:125px;background-position:center center;background-size:cover;margin:10px;border-radius:5px}.fatex-template__image--empty{background-image:url("icons/svg/mystery-man.svg")}.fatex-template__information-group{display:grid;grid-template-columns:-webkit-min-content auto;grid-template-columns:min-content auto;grid-auto-rows:auto;-webkit-column-gap:20px;-moz-column-gap:20px;column-gap:20px;margin-bottom:10px;padding:10px}.fatex-template__information-name{font-weight:bold;white-space:nowrap}.fatex-template__information-name::after{content:":"}.fatex-template__information-value{text-align:right}.fatex-template__or{text-transform:uppercase;padding:20px;font-size:30px;font-weight:bold}.fatex-template-action{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;white-space:nowrap;cursor:pointer}.fatex-template-action__icon{height:25px;font-size:23px}.fatex-template-action__label{text-transform:uppercase;font-size:10px;font-weight:300;letter-spacing:3px;padding-left:2px;padding-top:3px;white-space:nowrap}.fatex-artwork{position:relative;padding:10px}.fatex-artwork__image{vertical-align:bottom;width:100%}.fatex-artwork__wrapper{position:relative}.fatex-artwork__wrapper::before{content:"";position:absolute;top:-1px;left:-1px;border-top:26px solid #f1f2f6;border-right:26px solid rgba(0,0,0,0)}.fatex-artwork__wrapper::after{content:"";position:absolute;bottom:-1px;right:-1px;border-bottom:26px solid #f1f2f6;border-left:26px solid rgba(0,0,0,0)}.automation-list{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:10px;padding:0 10px}.automation-list__item{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;gap:5px}.automation-list__description{font-size:12px;padding-left:10px}.fatex-button{cursor:pointer;padding:5px;border-radius:4px}.fatex-button--clear-all{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;grid-area:r}.fatex-button--clear-all,.fatex-button--light{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;font-size:12px;border:1px solid #2f3542;-webkit-transition:all .3s;transition:all .3s}.fatex-button--clear-all:hover,.fatex-button--light:hover{background-color:rgba(0,0,0,.3)}.fatex-button--dark{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.fatex-button--dark,.fatex-button--square{gap:8px;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background:#2f3542;color:#fff}.fatex-button--dark:before{margin-right:10px}.fatex-button--square{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;padding:10px;font-size:10px;font-weight:bold;text-transform:uppercase;border-radius:0;-webkit-box-shadow:2px 2px 4px 0 #2f3542;box-shadow:2px 2px 4px 0 #2f3542}.fatex-button--square i{-webkit-transform:translateY(-1px);transform:translateY(-1px)}.fatex-button--setup{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;margin:10px auto 0 auto}.fatex-chat{font-size:24px;text-align:center}.fatex-chat__headline-container{position:relative;width:70%;margin:10px auto}.fatex-rollWrapper{position:relative}@-webkit-keyframes grow-shrink{0%{-webkit-transform:scale(1);transform:scale(1)}50%{-webkit-transform:scale(1.3);transform:scale(1.3)}100%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes grow-shrink{0%{-webkit-transform:scale(1);transform:scale(1)}50%{-webkit-transform:scale(1.3);transform:scale(1.3)}100%{-webkit-transform:scale(1);transform:scale(1)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fatex-roll{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;color:var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-roll .fatex-result{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;position:relative}.fatex-roll .fatex-result:hover .fatex-roll__history{display:block}.fatex-roll__history{display:none;position:absolute;bottom:100%;text-align:left;padding-bottom:10px;font-size:10px;color:#fff;z-index:200}.fatex-roll__history:hover{display:block}.fatex-roll__history div{white-space:nowrap;padding:5px 10px;background:rgba(0,0,0,.9)}.fatex-chat__roll--totalChanged .fatex-roll__total{-webkit-animation-name:grow-shrink;animation-name:grow-shrink;-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-iteration-count:1;animation-iteration-count:1;-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out}.fatex-chat__roll--reroll .fatex-roll .fatex-dice div{-webkit-animation-name:spin;animation-name:spin;-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-iteration-count:5;animation-iteration-count:5;-webkit-animation-timing-function:linear;animation-timing-function:linear}.fatex-roll__ladder{font-size:12px;font-weight:300}.fatex-roll__total{font-weight:700}.fatex-roll-actions{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:10px;margin:10px;text-align:center}.fatex-roll-actions button{text-align:center;border-radius:5px;width:30px;height:30px;line-height:1;background-color:rgba(0,0,0,0);font-family:"Montserrat",sans-serif;font-weight:bold;font-size:14px;white-space:nowrap;border:2px solid var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-roll-actions button i{padding:0;margin:0}.fatex-roll-actions button[data-action=increase]{text-indent:-2px}.fatex-roll-actions button:disabled{opacity:.5}.fatex-dice{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:50%;margin-bottom:20px;font-family:"Fate Icons",sans-serif}.fatex-dice--2d6-roll{font-family:"Montserrat",sans-serif;width:25%}.fatex-dice--2d6-roll div{display:block;width:24px;height:24px;background:var(--fatex-primary-color, rgb(47, 53, 66));border-radius:5px;color:#fff;font-size:16px;font-weight:bold;line-height:24px}.fatex-dice--2d6-roll label{line-height:24px;width:24px;height:24px}.fatex-dice div{width:24px;height:24px;text-align:center}.fatex-dice div.fatex-dice__magic_die{color:#a0191f}.fatex-checkbox{position:relative;width:30px;height:30px;font-size:24px;border:2px solid var(--fatex-primary-color, rgb(47, 53, 66));color:var(--fatex-primary-color, rgb(47, 53, 66));cursor:pointer}.fatex-checkbox__label{position:absolute;left:0;top:0;-webkit-transform:translate(-60%, -40%);transform:translate(-60%, -40%);font-weight:900;font-size:24px;text-shadow:1px 1px 1px #f1f2f6}.fatex-checkbox__icon{width:100%;text-align:center;opacity:0}.fatex-checkbox__input{display:none}.fatex-checkbox__input:checked+.fatex-checkbox__icon{opacity:1}.fatex-checkbox--consequence{position:absolute;top:0;right:100%;width:24px;height:24px;margin-right:5px;font-size:18px}.fatex-checkbox--filler{opacity:0;pointer-events:none}.fatex-copyright{grid-area:copyright;padding:10px;font-size:10px;text-align:center;color:var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-desk{display:grid;grid-template-rows:-webkit-min-content minmax(100px, 100%) -webkit-min-content;grid-template-rows:min-content minmax(100px, 100%) min-content;grid-template-areas:"header" "content" "footer";height:100%}.fatex-desk__aspects,.fatex-desk__consequences{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:10px;padding:10px}.fatex-desk__aspects--inline,.fatex-desk__consequences--inline{padding-left:0}.fatex-desk__content{grid-area:content;overflow-y:auto;scrollbar-width:thin}.fatex-desk__content--app{padding:10px}.fatex-desk__content--actor-sheet{display:grid;grid-template-columns:4fr 1fr}.fatex-desk__content--group{display:grid;grid-template-columns:repeat(3, 1fr);grid-auto-rows:-webkit-min-content;grid-auto-rows:min-content;gap:10px;padding:10px}.fatex-desk__footer{grid-area:footer}.fatex-desk__messages{grid-area:messages}.fatex-desk__sidebar{min-width:240px;-webkit-box-shadow:12px 0 15px 0 var(--fatex-primary-color, rgb(47, 53, 66));box-shadow:12px 0 15px 0 var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-desk__tabloid{min-width:650px;display:grid;grid-template-columns:55% 1fr;grid-template-rows:-webkit-min-content -webkit-min-content 1fr -webkit-min-content;grid-template-rows:min-content min-content 1fr min-content;grid-template-areas:"messages messages" "aspects consequences" "tabs tabs" "copyright copyright"}.fatex-desk__tabs{grid-area:tabs}.fatex-desk__tabs--vertical{display:grid;grid-template-columns:1fr 3fr;margin-bottom:-10px}.fatex-dialog{font-family:"Montserrat",sans-serif}.fatex-dialog button{font-family:"Montserrat",sans-serif}.fatex-dialog .window-content{padding:10px;background:#f1f2f6}.fatex-dialog .dialog-buttons{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-top:10px}.fatex-dialog .dialog-buttons button{background:rgba(0,0,0,.1);border:2px groove #f0f0e0}.fatex-header{position:relative;grid-area:header;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;height:100%;padding:10px 10px 8px 10px;font-size:23px;color:var(--fatex-header-text-color, #fff);background:var(--fatex-header-color, rgb(47, 53, 66));-webkit-box-shadow:0 2px 15px 0 var(--fatex-header-color, rgb(47, 53, 66));box-shadow:0 2px 15px 0 var(--fatex-header-color, rgb(47, 53, 66));z-index:5}.fatex-header__combine{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.fatex-header__image{height:40px;margin-right:10px}.fatex-header__image img{-webkit-box-flex:0;-webkit-flex:0 0 40px;-ms-flex:0 0 40px;flex:0 0 40px;height:40px;width:40px}.fatex-header__name{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;width:50%}.fatex-header__fate-points{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.fatex-header__label{text-transform:uppercase;font-size:10px;font-weight:300;letter-spacing:3px;padding-left:2px;padding-top:3px;white-space:nowrap}.fatex-header__label--center{padding-left:0;text-align:center}.fatex-header__fate-points-wrapper{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center}.fatex-header__fatepoint-divider{font-size:25px;line-height:25px}.fatex-header__logo{height:40px}.fatex-header__title{height:25px;font-size:23px;white-space:nowrap}.fatex-headline{position:relative;margin-bottom:.5rem;color:var(--fatex-light-text-color, #fff);background:var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-headline::before{content:"";position:absolute;top:-1px;left:-1px;border-top:16px solid #f1f2f6;border-right:16px solid rgba(0,0,0,0)}.fatex-headline::after{content:"";position:absolute;bottom:-1px;right:-1px;border-bottom:16px solid #f1f2f6;border-left:16px solid rgba(0,0,0,0)}.fatex-headline--center{text-align:center}.fatex-headline--chat{width:70%;margin:10px auto}.fatex-headline--fixed-icon{padding-right:40px}.fatex-headline--helper{display:none;cursor:pointer}.fatex-headline--inline-sheet{border-bottom:none;padding-right:50px}.fatex-headline--inline-sheet::before{border:none;bottom:initial;right:initial}.fatex-headline--inline-sheet::after{border:none;bottom:initial;right:initial;content:"";position:absolute;top:-1px;right:-1px;border-top:16px solid #f1f2f6;border-left:16px solid rgba(0,0,0,0)}.fatex-headline__icon{position:absolute;top:0;left:100%;z-index:100;-webkit-transform:translate(-25px, 0px);transform:translate(-25px, 0px);font-weight:900;color:#f1f2f6;-webkit-text-stroke:2px var(--fatex-primary-color, rgb(47, 53, 66));text-shadow:initial;white-space:nowrap}.fatex-headline__icon--skill{left:initial;right:100%;font-size:24px;text-shadow:1px 1px 1px #f1f2f6;-webkit-transform:translate(15px, -7px);transform:translate(15px, -7px)}.fatex-headline__icon--negative{color:#f21628}.fatex-headline__image{border-radius:0;height:32px;width:32px;-o-object-fit:cover;object-fit:cover;-o-object-position:0% 0;object-position:0% 0}.fatex-headline__text{position:relative;margin:0;padding:5px 20px;border:none;font-size:13px;font-weight:bold;text-transform:uppercase}.fatex-section-heading{display:block;position:relative;color:#191813}.fatex-section-heading--no-border{border:none;margin-bottom:10px}.fatex-section-heading h2{border-color:var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-js-edit-mode .fatex-headline--helper{display:inherit}.fatex__inline_sheet--hidden{opacity:.3}.fatex__inline_sheet--defeated{opacity:.5}.fatex__inline_sheet__headline{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-clip-path:none;clip-path:none}.fatex__inline_sheet--defeated .fatex__inline_sheet__headline{color:#f21628}.fatex__inline_sheet__content{display:grid}.fatex-inline-tabs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:5px;padding:0 5px;font-size:11px;color:#969799}.fatex-inline-tabs__item{padding:2px 5px;background:#cacbcf;border:1px solid #969799;border-radius:3px}.fatex-inline-tabs__item.active{background:var(--fatex-primary-color, rgb(47, 53, 66));color:#f1f2f6;border:none}.fatex-text-input,input[type=text].fatex-text-input{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;min-height:24px;padding:3px 0 3px 5px;background:rgba(0,0,0,0);border-radius:3px;border:none;border-bottom:1px solid var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-text-input::-webkit-input-placeholder, input[type=text].fatex-text-input::-webkit-input-placeholder{color:var(--fatex-primary-color, rgb(47, 53, 66));opacity:.3}.fatex-text-input::-moz-placeholder, input[type=text].fatex-text-input::-moz-placeholder{color:var(--fatex-primary-color, rgb(47, 53, 66));opacity:.3}.fatex-text-input:-ms-input-placeholder, input[type=text].fatex-text-input:-ms-input-placeholder{color:var(--fatex-primary-color, rgb(47, 53, 66));opacity:.3}.fatex-text-input::-ms-input-placeholder, input[type=text].fatex-text-input::-ms-input-placeholder{color:var(--fatex-primary-color, rgb(47, 53, 66));opacity:.3}.fatex-text-input::placeholder,input[type=text].fatex-text-input::placeholder{color:var(--fatex-primary-color, rgb(47, 53, 66));opacity:.3}.fatex-text-input:focus~.fatex-actions--item,input[type=text].fatex-text-input:focus~.fatex-actions--item{opacity:0;pointer-events:none}.fatex-text-input--fp,input[type=text].fatex-text-input--fp{width:40px;text-align:center}.fatex-text-input--fp,.fatex-text-input--header,input[type=text].fatex-text-input--fp,input[type=text].fatex-text-input--header{height:25px;padding:0;color:inherit;border:0}.fatex-text-input__icon,input[type=text].fatex-text-input__icon{position:absolute;left:-4px;top:0;-webkit-transform:translate(-60%, -40%);transform:translate(-60%, -40%);font-weight:900;font-size:24px;color:var(--fatex-primary-color, rgb(47, 53, 66));text-shadow:1px 1px 1px #f1f2f6}.fatex-text-input__label,input[type=text].fatex-text-input__label{padding-left:5px;font-size:8px;letter-spacing:3px;color:var(--fatex-primary-color, rgb(47, 53, 66));text-transform:uppercase;white-space:nowrap}.fatex-text-input__label:empty::before,input[type=text].fatex-text-input__label:empty::before{content:" "}.fatex-text-input__setting-label,input[type=text].fatex-text-input__setting-label{font-size:10px;padding-left:5px}input[type=number].fatex-text-input--headline{position:absolute;right:10px;width:initial;margin:0;padding:5px;font-size:13px;font-weight:bold;color:var(--fatex-light-text-color, #fff);text-transform:uppercase;text-align:center;border:none}.fatex__input--icon{padding-left:10px}[contentEditable=true]:empty:not(:focus):before{content:attr(data-placeholder);font-style:italic;opacity:.3;pointer-events:none}.fatex-item-description{padding:0 10px;font-size:12px;overflow-wrap:anywhere;max-width:100%;overflow-x:scroll}.fatex-item-grid{display:grid;gap:15px 20px;padding:10px 0 0 0}.fatex-item-grid--skills{width:30%;min-width:220px}.fatex-item-grid .item{overflow-x:hidden}.fatex-item-grid--two-column{grid-template-columns:1fr 1fr;width:50%;min-width:360px}.fatex-item--consequence{padding-left:14px}.fatex-item--condition{padding-left:36px}.fatex-item--inline-condition,.fatex-item--inline-consequence{padding-left:26px}.fatex-message{margin:10px;padding:5px;border:1px solid var(--fatex-primary-color, rgb(47, 53, 66));background:rgba(47,53,66,.3);border-radius:5px}.fatex-radio-group{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-justify-content:space-around;-ms-flex-pack:distribute;justify-content:space-around;gap:10px}.fatex-radio-group--ranks{gap:5px;padding:0 10px}.fatex-radio-rank,.fatex-radio-button{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;padding:5px;text-align:center;border:1px solid var(--fatex-primary-color, rgb(47, 53, 66));border-radius:5px;opacity:.3;cursor:pointer}.fatex-radio-rank--active,.fatex-radio-button--active{background:rgba(0,0,0,.05);opacity:1}.fatex-radio-rank__image,.fatex-radio-button__image{height:24px;margin:8px}.fatex-radio-rank__image--big,.fatex-radio-button__image--big{height:40px}.fatex-radio-rank__label,.fatex-radio-button__label{display:block;font-size:12px}.fatex-radio-rank{border:0;color:var(--fatex-primary-color, rgb(47, 53, 66));font-weight:900;font-size:24px;text-shadow:1px 1px 1px #f1f2f6}.fatex-radio-rank--active{background:none}.fatex-radio-rank--negative{color:#f21628;-webkit-text-stroke:2px var(--fatex-primary-color, rgb(47, 53, 66))}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{-webkit-box-shadow:0 0 1px #999 inset;box-shadow:0 0 1px #999 inset;border-radius:4px}::-webkit-scrollbar-thumb{outline:none;border-radius:3px;background:#2f3542 !important;border:0}:root{scrollbar-width:thin !important;scrollbar-color:#2f3542 #f1f2f6 !important}input[type=range]::-webkit-slider-thumb{background:#2f3542;width:18px;cursor:pointer;height:25px;margin-top:-10px}input[type=range]::-moz-range-thumb{background:#2f3542;height:25px;width:18px;cursor:pointer}.fatex-setting{padding:10px;-webkit-transition:opacity .3s;transition:opacity .3s}.fatex-setting--min-height{min-height:70px}.fatex-setting__checkbox label{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:5px}.fatex-setting__checkbox label div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.fatex-setting__checkbox__name{font-weight:bold;padding:5px 0}.fatex-setting__checkbox__help{font-size:12px}.fatex-setting__editor-wrapper{height:250px;overflow:hidden;border-bottom:1px solid var(--fatex-primary-color, rgb(47, 53, 66));border-radius:3px}.fatex-setting__editor-wrapper>.editor{height:250px}.fatex-setting__text div{min-height:200px}.fatex-sheet-config{padding:10px;display:none;-webkit-box-shadow:0 -2px 15px 0 #2f3542;box-shadow:0 -2px 15px 0 #2f3542;background:#2f3542;z-index:5;color:var(--fatex-light-text-color, #fff)}.fatex-js-edit-mode .fatex-sheet-config{display:block}.fatex-sheet-config h2{font-size:16px;text-transform:uppercase;border:0;font-weight:bold}.fatex-sheet{font-family:"Montserrat",sans-serif}.fatex-sheet--app{min-width:500px}.fatex-sheet--item{min-width:300px}.fatex-sheet .window-header a{margin-left:10px}.fatex-sheet .window-content{padding:0;background:#f1f2f6;overflow-y:hidden}.fatex-sheet a:hover{text-shadow:none}.fatex-sheet img{border:0}.fatex-sheet textarea{background:rgba(0,0,0,0);border:0;width:auto;height:auto}.fatex-skill{-webkit-column-break-inside:avoid;-moz-column-break-inside:avoid;break-inside:avoid;cursor:pointer}.fatex-js-edit-mode .fatex-skill{cursor:default}.fatex-slider{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;padding-right:20px}.fatex-slider__label[type=text]{width:50px;font-size:24px;font-weight:900;text-align:center;text-shadow:1px 1px 1px #f1f2f6;background:none;border:none}.fatex-stress-track{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:15px 24px;margin:15px 0 15px 12px}.fatex-tab-content{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;padding:10px 0}.fatex-tab-content--bio .editor{height:100%}.fatex-tab-content--skills{gap:20px;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row}.fatex-tab-content[data-tab].active{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.fatex-vertical-tabs-content{border-left:1px solid #000;margin-left:-1px}.fatex-tabs-navigation{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:space-around;-ms-flex-pack:distribute;justify-content:space-around;font-size:13px;font-weight:bold;color:var(--fatex-primary-color, rgb(47, 53, 66));text-transform:uppercase;border-bottom:2px solid var(--fatex-primary-color, rgb(47, 53, 66))}.fatex-tabs-navigation__item{position:relative;padding:5px 20px 5px 15px}.fatex-tabs-navigation__item.active,.fatex-tabs-navigation__item:hover{background:var(--fatex-primary-color, rgb(47, 53, 66));color:var(--fatex-light-text-color, #fff)}.fatex-tabs-navigation__item::after{content:"";position:absolute;top:-1px;right:-1px;border-top:16px solid #f1f2f6;border-left:16px solid rgba(0,0,0,0)}.fatex-vertical-tabs-navigation{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:20px 0}.fatex-vertical-tabs-navigation__item{color:var(--fatex-primary-color, rgb(47, 53, 66));padding:10px;text-transform:uppercase;margin-bottom:20px;font-size:13px;opacity:.3;width:175px;border:1px solid rgba(0,0,0,0);-webkit-transition:opacity .3s,background-color 0s;transition:opacity .3s,background-color 0s}.fatex-vertical-tabs-navigation__item.active,.fatex-vertical-tabs-navigation__item:hover{font-weight:bold;background:#f1f2f6;border:1px solid var(--fatex-primary-color, rgb(47, 53, 66));border-right:0;opacity:1;z-index:1;-webkit-box-shadow:0 3px 0 0 var(--fatex-primary-color, rgb(47, 53, 66));box-shadow:0 3px 0 0 var(--fatex-primary-color, rgb(47, 53, 66))}.fatex__headline{background:var(--fatex-primary-color, rgb(47, 53, 66));color:var(--fatex-light-text-color, #fff);padding:5px 20px 5px 20px;position:relative;font-weight:bold;text-transform:uppercase;text-align:center;font-size:13px;-webkit-box-shadow:1px 1px 1px #a0a0a0;box-shadow:1px 1px 1px #a0a0a0}.fatex__headline::before{content:"";position:absolute;top:-1px;left:-1px;border-top:16px solid #f1f2f6;border-right:16px solid rgba(0,0,0,0)}.fatex__headline::after{content:"";position:absolute;bottom:-1px;right:-1px;border-bottom:16px solid #f1f2f6;border-left:16px solid rgba(0,0,0,0)}.fatex__chat__headline__wrapper{width:70%;margin:auto;position:relative;margin-bottom:10px;margin-top:10px}.fatex__chat__headline__icon{position:absolute;top:0;left:100%;-webkit-transform:translate(-25px, 0px);transform:translate(-25px, 0px);font-weight:900;font-size:24px;color:#f1f2f6;-webkit-text-stroke:2px var(--fatex-primary-color, rgb(47, 53, 66));text-shadow:initial}.fatex__chat__headline__icon--negative{color:#f21628}.fatex__chat__dice{width:50%;margin:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-bottom:20px}.fatex__chat__die{font-family:"Fate Icons",sans-serif;font-size:24px;color:var(--fatex-primary-color, rgb(47, 53, 66))}.fatex__chat__total{text-align:center;font-weight:700;font-size:26px}.fatex__chat__ladder{color:var(--fatex-primary-color, rgb(47, 53, 66));font-weight:300;font-size:12px;display:block}.fatex-u-disabled{opacity:.3;pointer-events:none}.fatex-u-delete{-webkit-transition:color .2s;transition:color .2s}.fatex-u-delete:hover{color:#f21628}.fatex-u-padding-std{padding:10px}.fatex-u-pos-relative{position:relative}.fatex-u-full-height{height:100%}.fatex-u-full-width{width:100%}',""]),t.A=s},314:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a="",n=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),n&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),n&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a})).join("")},t.i=function(e,a,n,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var p=[].concat(e[c]);n&&s[p[0]]||(void 0!==r&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=r),a&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=a):p[2]=a),i&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=i):p[4]="".concat(i)),t.push(p))}},t}},601:function(e){e.exports=function(e){return e[1]}},72:function(e){var t=[];function a(e){for(var a=-1,n=0;n<t.length;n++)if(t[n].identifier===e){a=n;break}return a}function n(e,n){for(var r={},s=[],o=0;o<e.length;o++){var l=e[o],c=n.base?l[0]+n.base:l[0],p=r[c]||0,d="".concat(c," ").concat(p);r[c]=p+1;var f=a(d),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(u);else{var h=i(u,n);n.byIndex=o,t.splice(o,0,{identifier:d,updater:h,references:1})}s.push(d)}return s}function i(e,t){var a=t.domAPI(t);a.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;a.update(e=t)}else a.remove()}}e.exports=function(e,i){var r=n(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<r.length;s++){var o=a(r[s]);t[o].references--}for(var l=n(e,i),c=0;c<r.length;c++){var p=a(r[c]);0===t[p].references&&(t[p].updater(),t.splice(p,1))}r=l}}},659:function(e){var t={};e.exports=function(e,a){var n=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(a)}},540:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:function(e,t,a){e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},825:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var n="";a.supports&&(n+="@supports (".concat(a.supports,") {")),a.media&&(n+="@media ".concat(a.media," {"));var i=void 0!==a.layer;i&&(n+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),n+=a.css,i&&(n+="}"),a.media&&(n+="}"),a.supports&&(n+="}");var r=a.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,a),r.exports}a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.nc=void 0;var n=a(72),i=a.n(n),r=a(825),s=a.n(r),o=a(659),l=a.n(o),c=a(56),p=a.n(c),d=a(540),f=a.n(d),u=a(113),h=a.n(u),m=a(532),g={};g.styleTagTransform=h(),g.setAttributes=p(),g.insert=l().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=f();i()(m.A,g),m.A&&m.A.locals&&m.A.locals;class BaseComponent{static activateListeners(e,t){}static async getSheetData(e,t){return e}}const x={OPERATOR_EQUALS:0,OPERATOR_NOT_EQUALS:1,OPERATOR_GT:2,OPERATOR_LT:3,OPERATOR_GTE:4,OPERATOR_LTE:5},b={OR:0,AND:1},k=0,y=1;class Automation extends BaseComponent{static activateListeners(e,t){e.find(".fatex-js-create-skill-reference").on("click",(e=>this._onAddReference.call(this,e,t))),e.find(".fatex-js-create-skill-reference-boxes").on("click",(e=>this._onAddReference.call(this,e,t,y))),e.find(".fatex-js-change-skill-reference").on("change",(e=>this._onChangeReference.call(this,e,t))),e.find(".fatex-js-remove-skill-reference").on("click",(e=>this._onRemoveReference.call(this,e,t)))}static async getSheetData(e,t){const a=this.getSkillReferences(t.document).map(((e,t)=>(e.index=t,e)));return e.statusReferences=a.filter((e=>e.type===k||void 0===e.type)),e.boxReferences=a.filter((e=>e.type===y)),e.skillReferenceSettings=this.getSkillReferenceSettings(t.document),e.availableSkillLevels=this.getAvailableSkillLevels(),e.availableOperators=this.getAvailableOperators(),e.availableConjunctions=this.getAvailableConjunctions(),e.availableBoxCount=this.getAvailableBoxCount(),e.availableSkills=this.getAllAvailableSkills(),e}static async _onAddReference(e,t,a=k){e.preventDefault();const n=t.document;await this.addSkillReference(n,a)}static async _onChangeReference(e,t){e.preventDefault();let a=e.currentTarget.value;const n=e.currentTarget.dataset,i=t.document,r=n.index,s=n.field;"Number"===n.dtype&&(a=parseInt(a)),void 0!==r&&void 0!==s&&await this.changeSkillReference(i,r,s,a)}static async _onChangeSetting(e,t){e.preventDefault();let a=e.currentTarget.value;const n=e.currentTarget.dataset,i=t.document,r=n.setting;"Number"===n.dtype&&(a=parseInt(a)),void 0!==r&&await this.setReferenceSetting(i,r,a)}static async _onRemoveReference(e,t){e.preventDefault();const a=e.currentTarget.dataset,n=t.document,i=a.index;void 0!==i&&new Dialog({title:game.i18n.localize("FAx.Dialog.ReferenceRemove"),content:game.i18n.localize("FAx.Dialog.ReferenceRemoveText"),default:"submit",buttons:{cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("FAx.Dialog.Cancel"),callback:()=>null},submit:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("FAx.Dialog.Confirm"),callback:async()=>{await this.removeSkillReference(n,i)}}}},{classes:["fatex","fatex-dialog"]}).render(!0)}static async addSkillReference(e,t=k){const a=this.getSkillReferences(e),n=foundry.utils.duplicate(a);n.push({type:t,skill:"",condition:0,operator:x.OPERATOR_GTE,default:0,action:0,argument:0,argument2:0,argument3:0}),await e.setFlag("fatex","skillReferences",n)}static async changeSkillReference(e,t,a,n){const i=this.getSkillReferences(e),r=foundry.utils.duplicate(i),s=r[t];s[a]=n,r.splice(t,1,s),await e.setFlag("fatex","skillReferences",r)}static async removeSkillReference(e,t){const a=this.getSkillReferences(e),n=duplicate(a);n.splice(t,1),await e.setFlag("fatex","skillReferences",n)}static async setReferenceSetting(e,t,a){await e.setFlag("fatex",`skillReferenceSettings.${t}`,a)}static getReferenceSetting(e,t,a){const n=null==e?void 0:e.getFlag("fatex",`skillReferenceSettings.${t}`);return void 0===n?a:n}static getSkillReferences(e){return e.getFlag("fatex","skillReferences")||[]}static getAllAvailableSkills(e=!0){var t;const a=[...new Set(null===(t=game.actors)||void 0===t?void 0:t.map((e=>Array.from(e.items.values()).filter((e=>"skill"===e.type)).map((e=>e.name)))).flat())];return e&&a.sort(((e,t)=>e&&t?e.toLowerCase().localeCompare(t.toLowerCase()):0)),a}static getActorSkillByName(e,t){const a=foundry.utils.duplicate(e).items.filter((e=>"skill"===e.type&&e.name===t));if(a)return a[0]}static getAvailableSkillLevels(){return[...Array(21).keys()].map((e=>({value:e,label:`+${e}`})))}static getAvailableBoxCount(){return[...Array(21).keys()].map((e=>({value:e-10,label:`${e-10>=0?"+":""}${e-10}`})))}static getAvailableOperators(){return Object.keys(x).map((e=>({value:x[e],label:game.i18n.localize(`FAx.Item.Automation.Operators.${e}`)})))}static getAvailableConjunctions(){return Object.keys(b).map((e=>({value:b[e],label:game.i18n.localize(`FAx.Item.Automation.Conjunctions.${e}`)})))}static checkSkillCondition(e,t,a=x.OPERATOR_GTE){const n=e.system.rank;switch(a){case x.OPERATOR_EQUALS:return n===t;case x.OPERATOR_NOT_EQUALS:return n!==t;case x.OPERATOR_GTE:return n>=t;case x.OPERATOR_GT:return n>t;case x.OPERATOR_LTE:return n<=t;case x.OPERATOR_LT:return n<t}return!1}static getSkillReferenceSettings(e){return{conjunction:this.getReferenceSetting(e,"conjunction",b.OR)}}static getBoxAmountModifier(e){return Automation.getSkillReferences(e).filter((e=>e.type===y)).reduce(((t,a)=>{const n=Automation.getActorSkillByName(e.actor,a.skill);return t+(void 0!==n&&Automation.checkSkillCondition(n,a.condition,a.operator)?a.argument:0)}),0)}static getDisabledState(e){let t=!1;const a=Automation.getSkillReferences(e).filter((e=>e.type===k||void 0===e.type)),n=Automation.getReferenceSetting(e,"conjunction",b.OR);n===b.OR&&a.length&&(t=!0);for(const t of a){const a=Automation.getActorSkillByName(e.actor,t.skill),i=void 0!==a&&Automation.checkSkillCondition(a,t.condition,t.operator);if(n===b.OR&&i)return!1;if(n===b.AND&&!i)return!0}return t}}class BaseItem{static prepareItemData(e,t){return e}static activateActorSheetListeners(e,t){if(!this.documentName)throw new Error("A subclass of the BaseItem must provide an documentName field or implement their own _onItemAdd() method.");e.find(`.fatex-js-${this.documentName}-add`).click((e=>this._onItemAdd.call(this,e,t))),e.find(`.fatex-js-${this.documentName}-settings`).click((e=>this._onItemSettings.call(this,e,t))),e.find(`.fatex-js-${this.documentName}-delete`).click((e=>this._onItemDelete.call(this,e,t)))}static async getSheetData(e,t){return e}static async getActorSheetData(e,t){return e}static activateListeners(e,t){}static async _onItemAdd(e,t){if(e.preventDefault(),e.stopPropagation(),!this.documentName)throw new Error("A subclass of the BaseItem must provide an documentName field or implement their own _onItemAdd() method.");const a={name:this.defaultName,type:this.documentName,sort:9e6};await this.createNewItem(a,t)}static _onItemSettings(e,t){e.preventDefault(),e.stopPropagation();const a=e.currentTarget.dataset;t.actor.items.map((e=>{console.log("SHEET ITEMS"+e)}));const n=t.actor.items.get(a.item);n&&n.sheet.render(!0)}static _onItemDelete(e,t){e.preventDefault(),e.stopPropagation();const a=e.currentTarget.dataset,n=t.actor.items.get(a.item);new Dialog({title:`${game.i18n.localize("FAx.Dialog.DocumentDelete")} ${n.name}`,content:game.i18n.localize("FAx.Dialog.DocumentDeleteText"),default:"submit",buttons:{cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("FAx.Dialog.Cancel"),callback:()=>null},submit:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("FAx.Dialog.Confirm"),callback:async()=>{n.delete()}}}},{classes:["fatex","fatex-dialog"]}).render(!0)}static async createNewItem(e,t,a=!0){await t.actor.createEmbeddedDocuments("Item",[e],{renderSheet:a})}static get defaultName(){return this.documentName.charAt(0).toUpperCase()+this.documentName.slice(1)}static isEditMode(e){return!!jQuery(e.currentTarget).closest(".fatex-js-edit-mode").length}}BaseItem.documentName="";class AspectItem extends BaseItem{static activateActorSheetListeners(e,t){super.activateActorSheetListeners(e,t),e.find(".fatex-js-aspect-input").on("blur",(e=>this._onAspectTextChange.call(this,e,t)))}static _onAspectTextChange(e,t){e.preventDefault();const a=e.currentTarget.dataset,n=t.actor.items.get(a.itemId),i=$(e.currentTarget).html();n.system.value!==i&&n&&n.update({"system.value":i})}}AspectItem.documentName="aspect";const v=0,w=1;class ConsequenceItem extends BaseItem{static prepareItemData(e,t){return e.isConsequence=e.system.type===v,e.isCondition=e.system.type===w,t.isOwned&&(e.isDisabled=Automation.getDisabledState(t)),e}static activateActorSheetListeners(e,t){super.activateActorSheetListeners(e,t),e.find(".fatex-js-consequence-checkbox").click((e=>this._onToggleCondition.call(this,e,t))),e.find(".fatex-js-consequence-input").on("blur",(e=>this._onConsequenceTextChange.call(this,e,t)))}static _onToggleCondition(e,t){e.preventDefault();const a=e.currentTarget.dataset,n=t.actor.items.get(a.item);n&&n.update({"system.active":!n.system.active},{})}static _onConsequenceTextChange(e,t){e.preventDefault();const a=e.currentTarget.dataset,n=t.actor.items.get(a.itemId),i=$(e.currentTarget).html();n.system.value!==i&&n&&n.update({"system.value":i},{})}}function _(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}ConsequenceItem.documentName="consequence";let S={async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1};function T(e){S=e}const A=/[&<>"']/,C=new RegExp(A.source,"g"),D=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,I=new RegExp(D.source,"g"),F={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},R=e=>F[e];function E(e,t){if(t){if(A.test(e))return e.replace(C,R)}else if(D.test(e))return e.replace(I,R);return e}const O=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function z(e){return e.replace(O,((e,t)=>"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const N=/(^|[^\[])\^/g;function M(e,t){e="string"==typeof e?e:e.source,t=t||"";const a={replace:(t,n)=>(n=(n=n.source||n).replace(N,"$1"),e=e.replace(t,n),a),getRegex:()=>new RegExp(e,t)};return a}const j=/[^\w:]/g,P=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function L(e,t,a){if(e){let e;try{e=decodeURIComponent(z(a)).replace(j,"").toLowerCase()}catch(e){return null}if(0===e.indexOf("javascript:")||0===e.indexOf("vbscript:")||0===e.indexOf("data:"))return null}t&&!P.test(a)&&(a=function(e,t){B[" "+e]||(X.test(e)?B[" "+e]=e+"/":B[" "+e]=Y(e,"/",!0));e=B[" "+e];const a=-1===e.indexOf(":");return"//"===t.substring(0,2)?a?t:e.replace(H,"$1")+t:"/"===t.charAt(0)?a?t:e.replace(G,"$1")+t:e+t}(t,a));try{a=encodeURI(a).replace(/%25/g,"%")}catch(e){return null}return a}const B={},X=/^[^:]+:\/*[^/]*$/,H=/^([^:]+:)[\s\S]*$/,G=/^([^:]+:\/*[^/]*)[\s\S]*$/;const q={exec:function(){}};function U(e,t){const a=e.replace(/\|/g,((e,t,a)=>{let n=!1,i=t;for(;--i>=0&&"\\"===a[i];)n=!n;return n?"|":" |"})).split(/ \|/);let n=0;if(a[0].trim()||a.shift(),a.length>0&&!a[a.length-1].trim()&&a.pop(),a.length>t)a.splice(t);else for(;a.length<t;)a.push("");for(;n<a.length;n++)a[n]=a[n].trim().replace(/\\\|/g,"|");return a}function Y(e,t,a){const n=e.length;if(0===n)return"";let i=0;for(;i<n;){const r=e.charAt(n-i-1);if(r!==t||a){if(r===t||!a)break;i++}else i++}return e.slice(0,n-i)}function Z(e,t,a,n){const i=t.href,r=t.title?E(t.title):null,s=e[1].replace(/\\([\[\]])/g,"$1");if("!"!==e[0].charAt(0)){n.state.inLink=!0;const e={type:"link",raw:a,href:i,title:r,text:s,tokens:n.inlineTokens(s)};return n.state.inLink=!1,e}return{type:"image",raw:a,href:i,title:r,text:E(s)}}class Tokenizer{constructor(e){this.options=e||S}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:Y(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],a=function(e,t){const a=e.match(/^(\s+)(?:```)/);if(null===a)return t;const n=a[1];return t.split("\n").map((e=>{const t=e.match(/^\s+/);if(null===t)return e;const[a]=t;return a.length>=n.length?e.slice(n.length):e})).join("\n")}(e,t[3]||"");return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:a}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(/#$/.test(e)){const t=Y(e,"#");this.options.pedantic?e=t.trim():t&&!/ $/.test(t)||(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const e=t[0].replace(/^ *>[ \t]?/gm,""),a=this.lexer.state.top;this.lexer.state.top=!0;const n=this.lexer.blockTokens(e);return this.lexer.state.top=a,{type:"blockquote",raw:t[0],tokens:n,text:e}}}list(e){let t=this.rules.block.list.exec(e);if(t){let a,n,i,r,s,o,l,c,p,d,f,u,h=t[1].trim();const m=h.length>1,g={type:"list",raw:"",ordered:m,start:m?+h.slice(0,-1):"",loose:!1,items:[]};h=m?`\\d{1,9}\\${h.slice(-1)}`:`\\${h}`,this.options.pedantic&&(h=m?h:"[*+-]");const x=new RegExp(`^( {0,3}${h})((?:[\t ][^\\n]*)?(?:\\n|$))`);for(;e&&(u=!1,t=x.exec(e))&&!this.rules.block.hr.test(e);){if(a=t[0],e=e.substring(a.length),c=t[2].split("\n",1)[0].replace(/^\t+/,(e=>" ".repeat(3*e.length))),p=e.split("\n",1)[0],this.options.pedantic?(r=2,f=c.trimLeft()):(r=t[2].search(/[^ ]/),r=r>4?1:r,f=c.slice(r),r+=t[1].length),o=!1,!c&&/^ *$/.test(p)&&(a+=p+"\n",e=e.substring(p.length+1),u=!0),!u){const t=new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),n=new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),i=new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),s=new RegExp(`^ {0,${Math.min(3,r-1)}}#`);for(;e&&(d=e.split("\n",1)[0],p=d,this.options.pedantic&&(p=p.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!i.test(p))&&!s.test(p)&&!t.test(p)&&!n.test(e);){if(p.search(/[^ ]/)>=r||!p.trim())f+="\n"+p.slice(r);else{if(o)break;if(c.search(/[^ ]/)>=4)break;if(i.test(c))break;if(s.test(c))break;if(n.test(c))break;f+="\n"+p}o||p.trim()||(o=!0),a+=d+"\n",e=e.substring(d.length+1),c=p.slice(r)}}g.loose||(l?g.loose=!0:/\n *\n *$/.test(a)&&(l=!0)),this.options.gfm&&(n=/^\[[ xX]\] /.exec(f),n&&(i="[ ] "!==n[0],f=f.replace(/^\[[ xX]\] +/,""))),g.items.push({type:"list_item",raw:a,task:!!n,checked:i,loose:!1,text:f}),g.raw+=a}g.items[g.items.length-1].raw=a.trimRight(),g.items[g.items.length-1].text=f.trimRight(),g.raw=g.raw.trimRight();const b=g.items.length;for(s=0;s<b;s++)if(this.lexer.state.top=!1,g.items[s].tokens=this.lexer.blockTokens(g.items[s].text,[]),!g.loose){const e=g.items[s].tokens.filter((e=>"space"===e.type)),t=e.length>0&&e.some((e=>/\n.*\n/.test(e.raw)));g.loose=t}if(g.loose)for(s=0;s<b;s++)g.items[s].loose=!0;return g}}html(e){const t=this.rules.block.html.exec(e);if(t){const e={type:"html",block:!0,raw:t[0],pre:!this.options.sanitizer&&("pre"===t[1]||"script"===t[1]||"style"===t[1]),text:t[0]};if(this.options.sanitize){const a=this.options.sanitizer?this.options.sanitizer(t[0]):E(t[0]);e.type="paragraph",e.text=a,e.tokens=this.lexer.inline(a)}return e}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(/\s+/g," "),a=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",n=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:a,title:n}}}table(e){const t=this.rules.block.table.exec(e);if(t){const e={type:"table",header:U(t[1]).map((e=>({text:e}))),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(e.header.length===e.align.length){e.raw=t[0];let a,n,i,r,s=e.align.length;for(a=0;a<s;a++)/^ *-+: *$/.test(e.align[a])?e.align[a]="right":/^ *:-+: *$/.test(e.align[a])?e.align[a]="center":/^ *:-+ *$/.test(e.align[a])?e.align[a]="left":e.align[a]=null;for(s=e.rows.length,a=0;a<s;a++)e.rows[a]=U(e.rows[a],e.header.length).map((e=>({text:e})));for(s=e.header.length,n=0;n<s;n++)e.header[n].tokens=this.lexer.inline(e.header[n].text);for(s=e.rows.length,n=0;n<s;n++)for(r=e.rows[n],i=0;i<r.length;i++)r[i].tokens=this.lexer.inline(r[i].text);return e}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:E(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):E(t[0]):t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&/^</.test(e)){if(!/>$/.test(e))return;const t=Y(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=function(e,t){if(-1===e.indexOf(t[1]))return-1;const a=e.length;let n=0,i=0;for(;i<a;i++)if("\\"===e[i])i++;else if(e[i]===t[0])n++;else if(e[i]===t[1]&&(n--,n<0))return i;return-1}(t[2],"()");if(e>-1){const a=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,a).trim(),t[3]=""}}let a=t[2],n="";if(this.options.pedantic){const e=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(a);e&&(a=e[1],n=e[3])}else n=t[3]?t[3].slice(1,-1):"";return a=a.trim(),/^</.test(a)&&(a=this.options.pedantic&&!/>$/.test(e)?a.slice(1):a.slice(1,-1)),Z(t,{href:a?a.replace(this.rules.inline._escapes,"$1"):a,title:n?n.replace(this.rules.inline._escapes,"$1"):n},t[0],this.lexer)}}reflink(e,t){let a;if((a=this.rules.inline.reflink.exec(e))||(a=this.rules.inline.nolink.exec(e))){let e=(a[2]||a[1]).replace(/\s+/g," ");if(e=t[e.toLowerCase()],!e){const e=a[0].charAt(0);return{type:"text",raw:e,text:e}}return Z(a,e,a[0],this.lexer)}}emStrong(e,t,a=""){let n=this.rules.inline.emStrong.lDelim.exec(e);if(!n)return;if(n[3]&&a.match(/[\p{L}\p{N}]/u))return;if(!(n[1]||n[2]||"")||!a||this.rules.inline.punctuation.exec(a)){const a=n[0].length-1;let i,r,s=a,o=0;const l="*"===n[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+a);null!=(n=l.exec(t));){if(i=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!i)continue;if(r=i.length,n[3]||n[4]){s+=r;continue}if((n[5]||n[6])&&a%3&&!((a+r)%3)){o+=r;continue}if(s-=r,s>0)continue;r=Math.min(r,r+s+o);const t=e.slice(0,a+n.index+r+1);if(Math.min(a,r)%2){const e=t.slice(1,-1);return{type:"em",raw:t,text:e,tokens:this.lexer.inlineTokens(e)}}const l=t.slice(2,-2);return{type:"strong",raw:t,text:l,tokens:this.lexer.inlineTokens(l)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(/\n/g," ");const a=/[^ ]/.test(e),n=/^ /.test(e)&&/ $/.test(e);return a&&n&&(e=e.substring(1,e.length-1)),e=E(e,!0),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e,t){const a=this.rules.inline.autolink.exec(e);if(a){let e,n;return"@"===a[2]?(e=E(this.options.mangle?t(a[1]):a[1]),n="mailto:"+e):(e=E(a[1]),n=e),{type:"link",raw:a[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e,t){let a;if(a=this.rules.inline.url.exec(e)){let e,n;if("@"===a[2])e=E(this.options.mangle?t(a[0]):a[0]),n="mailto:"+e;else{let t;do{t=a[0],a[0]=this.rules.inline._backpedal.exec(a[0])[0]}while(t!==a[0]);e=E(a[0]),n="www."===a[1]?"http://"+a[0]:a[0]}return{type:"link",raw:a[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e,t){const a=this.rules.inline.text.exec(e);if(a){let e;return e=this.lexer.state.inRawBlock?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(a[0]):E(a[0]):a[0]:E(this.options.smartypants?t(a[0]):a[0]),{type:"text",raw:a[0],text:e}}}}const Q={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:q,lheading:/^((?:(?!^bull ).|\n(?!\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};Q.def=M(Q.def).replace("label",Q._label).replace("title",Q._title).getRegex(),Q.bullet=/(?:[*+-]|\d{1,9}[.)])/,Q.listItemStart=M(/^( *)(bull) */).replace("bull",Q.bullet).getRegex(),Q.list=M(Q.list).replace(/bull/g,Q.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Q.def.source+")").getRegex(),Q._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Q._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,Q.html=M(Q.html,"i").replace("comment",Q._comment).replace("tag",Q._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Q.lheading=M(Q.lheading).replace(/bull/g,Q.bullet).getRegex(),Q.paragraph=M(Q._paragraph).replace("hr",Q.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Q._tag).getRegex(),Q.blockquote=M(Q.blockquote).replace("paragraph",Q.paragraph).getRegex(),Q.normal={...Q},Q.gfm={...Q.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"},Q.gfm.table=M(Q.gfm.table).replace("hr",Q.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Q._tag).getRegex(),Q.gfm.paragraph=M(Q._paragraph).replace("hr",Q.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Q.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Q._tag).getRegex(),Q.pedantic={...Q.normal,html:M("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",Q._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:q,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:M(Q.normal._paragraph).replace("hr",Q.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",Q.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const K={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:q,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,rDelimAst:/^[^_*]*?__[^_*]*?\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\*)[punct](\*+)(?=[\s]|$)|[^punct\s](\*+)(?!\*)(?=[punct\s]|$)|(?!\*)[punct\s](\*+)(?=[^punct\s])|[\s](\*+)(?!\*)(?=[punct])|(?!\*)[punct](\*+)(?!\*)(?=[punct])|[^punct\s](\*+)(?=[^punct\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\s]|$)|[^punct\s](_+)(?!_)(?=[punct\s]|$)|(?!_)[punct\s](_+)(?=[^punct\s])|[\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:q,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^((?![*_])[\spunctuation])/};function W(e){return e.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function J(e){let t,a,n="";const i=e.length;for(t=0;t<i;t++)a=e.charCodeAt(t),Math.random()>.5&&(a="x"+a.toString(16)),n+="&#"+a+";";return n}K._punctuation="\\p{P}$+<=>`^|~",K.punctuation=M(K.punctuation,"u").replace(/punctuation/g,K._punctuation).getRegex(),K.blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,K.anyPunctuation=/\\[punct]/g,K._escapes=/\\([punct])/g,K._comment=M(Q._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),K.emStrong.lDelim=M(K.emStrong.lDelim,"u").replace(/punct/g,K._punctuation).getRegex(),K.emStrong.rDelimAst=M(K.emStrong.rDelimAst,"gu").replace(/punct/g,K._punctuation).getRegex(),K.emStrong.rDelimUnd=M(K.emStrong.rDelimUnd,"gu").replace(/punct/g,K._punctuation).getRegex(),K.anyPunctuation=M(K.anyPunctuation,"gu").replace(/punct/g,K._punctuation).getRegex(),K._escapes=M(K._escapes,"gu").replace(/punct/g,K._punctuation).getRegex(),K._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,K._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,K.autolink=M(K.autolink).replace("scheme",K._scheme).replace("email",K._email).getRegex(),K._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,K.tag=M(K.tag).replace("comment",K._comment).replace("attribute",K._attribute).getRegex(),K._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,K._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,K._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,K.link=M(K.link).replace("label",K._label).replace("href",K._href).replace("title",K._title).getRegex(),K.reflink=M(K.reflink).replace("label",K._label).replace("ref",Q._label).getRegex(),K.nolink=M(K.nolink).replace("ref",Q._label).getRegex(),K.reflinkSearch=M(K.reflinkSearch,"g").replace("reflink",K.reflink).replace("nolink",K.nolink).getRegex(),K.normal={...K},K.pedantic={...K.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:M(/^!?\[(label)\]\((.*?)\)/).replace("label",K._label).getRegex(),reflink:M(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",K._label).getRegex()},K.gfm={...K.normal,escape:M(K.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},K.gfm.url=M(K.gfm.url,"i").replace("email",K.gfm._extended_email).getRegex(),K.breaks={...K.gfm,br:M(K.br).replace("{2,}","*").getRegex(),text:M(K.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};class Lexer{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||S,this.options.tokenizer=this.options.tokenizer||new Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:Q.normal,inline:K.normal};this.options.pedantic?(t.block=Q.pedantic,t.inline=K.pedantic):this.options.gfm&&(t.block=Q.gfm,this.options.breaks?t.inline=K.breaks:t.inline=K.gfm),this.tokenizer.rules=t}static get rules(){return{block:Q,inline:K}}static lex(e,t){return new Lexer(t).lex(e)}static lexInline(e,t){return new Lexer(t).inlineTokens(e)}lex(e){let t;for(e=e.replace(/\r\n|\r/g,"\n"),this.blockTokens(e,this.tokens);t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){let a,n,i,r;for(e=this.options.pedantic?e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e.replace(/^( *)(\t+)/gm,((e,t,a)=>t+"    ".repeat(a.length)));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some((n=>!!(a=n.call({lexer:this},e,t))&&(e=e.substring(a.raw.length),t.push(a),!0)))))if(a=this.tokenizer.space(e))e=e.substring(a.raw.length),1===a.raw.length&&t.length>0?t[t.length-1].raw+="\n":t.push(a);else if(a=this.tokenizer.code(e))e=e.substring(a.raw.length),n=t[t.length-1],!n||"paragraph"!==n.type&&"text"!==n.type?t.push(a):(n.raw+="\n"+a.raw,n.text+="\n"+a.text,this.inlineQueue[this.inlineQueue.length-1].src=n.text);else if(a=this.tokenizer.fences(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.heading(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.hr(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.blockquote(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.list(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.html(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.def(e))e=e.substring(a.raw.length),n=t[t.length-1],!n||"paragraph"!==n.type&&"text"!==n.type?this.tokens.links[a.tag]||(this.tokens.links[a.tag]={href:a.href,title:a.title}):(n.raw+="\n"+a.raw,n.text+="\n"+a.raw,this.inlineQueue[this.inlineQueue.length-1].src=n.text);else if(a=this.tokenizer.table(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.lheading(e))e=e.substring(a.raw.length),t.push(a);else{if(i=e,this.options.extensions&&this.options.extensions.startBlock){let t=1/0;const a=e.slice(1);let n;this.options.extensions.startBlock.forEach((function(e){n=e.call({lexer:this},a),"number"==typeof n&&n>=0&&(t=Math.min(t,n))})),t<1/0&&t>=0&&(i=e.substring(0,t+1))}if(this.state.top&&(a=this.tokenizer.paragraph(i)))n=t[t.length-1],r&&"paragraph"===n.type?(n.raw+="\n"+a.raw,n.text+="\n"+a.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=n.text):t.push(a),r=i.length!==e.length,e=e.substring(a.raw.length);else if(a=this.tokenizer.text(e))e=e.substring(a.raw.length),n=t[t.length-1],n&&"text"===n.type?(n.raw+="\n"+a.raw,n.text+="\n"+a.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=n.text):t.push(a);else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let a,n,i,r,s,o,l=e;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(r=this.tokenizer.rules.inline.reflinkSearch.exec(l));)e.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(r=this.tokenizer.rules.inline.blockSkip.exec(l));)l=l.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(r=this.tokenizer.rules.inline.anyPunctuation.exec(l));)l=l.slice(0,r.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(s||(o=""),s=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some((n=>!!(a=n.call({lexer:this},e,t))&&(e=e.substring(a.raw.length),t.push(a),!0)))))if(a=this.tokenizer.escape(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.tag(e))e=e.substring(a.raw.length),n=t[t.length-1],n&&"text"===a.type&&"text"===n.type?(n.raw+=a.raw,n.text+=a.text):t.push(a);else if(a=this.tokenizer.link(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(a.raw.length),n=t[t.length-1],n&&"text"===a.type&&"text"===n.type?(n.raw+=a.raw,n.text+=a.text):t.push(a);else if(a=this.tokenizer.emStrong(e,l,o))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.codespan(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.br(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.del(e))e=e.substring(a.raw.length),t.push(a);else if(a=this.tokenizer.autolink(e,J))e=e.substring(a.raw.length),t.push(a);else if(this.state.inLink||!(a=this.tokenizer.url(e,J))){if(i=e,this.options.extensions&&this.options.extensions.startInline){let t=1/0;const a=e.slice(1);let n;this.options.extensions.startInline.forEach((function(e){n=e.call({lexer:this},a),"number"==typeof n&&n>=0&&(t=Math.min(t,n))})),t<1/0&&t>=0&&(i=e.substring(0,t+1))}if(a=this.tokenizer.inlineText(i,W))e=e.substring(a.raw.length),"_"!==a.raw.slice(-1)&&(o=a.raw.slice(-1)),s=!0,n=t[t.length-1],n&&"text"===n.type?(n.raw+=a.raw,n.text+=a.text):t.push(a);else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}else e=e.substring(a.raw.length),t.push(a);return t}}class Renderer{constructor(e){this.options=e||S}code(e,t,a){const n=(t||"").match(/\S*/)[0];if(this.options.highlight){const t=this.options.highlight(e,n);null!=t&&t!==e&&(a=!0,e=t)}return e=e.replace(/\n$/,"")+"\n",n?'<pre><code class="'+this.options.langPrefix+E(n)+'">'+(a?e:E(e,!0))+"</code></pre>\n":"<pre><code>"+(a?e:E(e,!0))+"</code></pre>\n"}blockquote(e){return`<blockquote>\n${e}</blockquote>\n`}html(e,t){return e}heading(e,t,a,n){if(this.options.headerIds){return`<h${t} id="${this.options.headerPrefix+n.slug(a)}">${e}</h${t}>\n`}return`<h${t}>${e}</h${t}>\n`}hr(){return this.options.xhtml?"<hr/>\n":"<hr>\n"}list(e,t,a){const n=t?"ol":"ul";return"<"+n+(t&&1!==a?' start="'+a+'"':"")+">\n"+e+"</"+n+">\n"}listitem(e){return`<li>${e}</li>\n`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>\n`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),"<table>\n<thead>\n"+e+"</thead>\n"+t+"</table>\n"}tablerow(e){return`<tr>\n${e}</tr>\n`}tablecell(e,t){const a=t.header?"th":"td";return(t.align?`<${a} align="${t.align}">`:`<${a}>`)+e+`</${a}>\n`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,t,a){if(null===(e=L(this.options.sanitize,this.options.baseUrl,e)))return a;let n='<a href="'+e+'"';return t&&(n+=' title="'+t+'"'),n+=">"+a+"</a>",n}image(e,t,a){if(null===(e=L(this.options.sanitize,this.options.baseUrl,e)))return a;let n=`<img src="${e}" alt="${a}"`;return t&&(n+=` title="${t}"`),n+=this.options.xhtml?"/>":">",n}text(e){return e}}class TextRenderer{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,a){return""+a}image(e,t,a){return""+a}br(){return""}}class Slugger{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,t){let a=e,n=0;if(this.seen.hasOwnProperty(a)){n=this.seen[e];do{n++,a=e+"-"+n}while(this.seen.hasOwnProperty(a))}return t||(this.seen[e]=n,this.seen[a]=0),a}slug(e,t={}){const a=this.serialize(e);return this.getNextSafeSlug(a,t.dryrun)}}class Parser{constructor(e){this.options=e||S,this.options.renderer=this.options.renderer||new Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new TextRenderer,this.slugger=new Slugger}static parse(e,t){return new Parser(t).parse(e)}static parseInline(e,t){return new Parser(t).parseInline(e)}parse(e,t=!0){let a,n,i,r,s,o,l,c,p,d,f,u,h,m,g,x,b,k,y,v="";const w=e.length;for(a=0;a<w;a++)if(d=e[a],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[d.type]&&(y=this.options.extensions.renderers[d.type].call({parser:this},d),!1!==y||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type)))v+=y||"";else switch(d.type){case"space":continue;case"hr":v+=this.renderer.hr();continue;case"heading":v+=this.renderer.heading(this.parseInline(d.tokens),d.depth,z(this.parseInline(d.tokens,this.textRenderer)),this.slugger);continue;case"code":v+=this.renderer.code(d.text,d.lang,d.escaped);continue;case"table":for(c="",l="",r=d.header.length,n=0;n<r;n++)l+=this.renderer.tablecell(this.parseInline(d.header[n].tokens),{header:!0,align:d.align[n]});for(c+=this.renderer.tablerow(l),p="",r=d.rows.length,n=0;n<r;n++){for(o=d.rows[n],l="",s=o.length,i=0;i<s;i++)l+=this.renderer.tablecell(this.parseInline(o[i].tokens),{header:!1,align:d.align[i]});p+=this.renderer.tablerow(l)}v+=this.renderer.table(c,p);continue;case"blockquote":p=this.parse(d.tokens),v+=this.renderer.blockquote(p);continue;case"list":for(f=d.ordered,u=d.start,h=d.loose,r=d.items.length,p="",n=0;n<r;n++)g=d.items[n],x=g.checked,b=g.task,m="",g.task&&(k=this.renderer.checkbox(x),h?g.tokens.length>0&&"paragraph"===g.tokens[0].type?(g.tokens[0].text=k+" "+g.tokens[0].text,g.tokens[0].tokens&&g.tokens[0].tokens.length>0&&"text"===g.tokens[0].tokens[0].type&&(g.tokens[0].tokens[0].text=k+" "+g.tokens[0].tokens[0].text)):g.tokens.unshift({type:"text",text:k}):m+=k),m+=this.parse(g.tokens,h),p+=this.renderer.listitem(m,b,x);v+=this.renderer.list(p,f,u);continue;case"html":v+=this.renderer.html(d.text,d.block);continue;case"paragraph":v+=this.renderer.paragraph(this.parseInline(d.tokens));continue;case"text":for(p=d.tokens?this.parseInline(d.tokens):d.text;a+1<w&&"text"===e[a+1].type;)d=e[++a],p+="\n"+(d.tokens?this.parseInline(d.tokens):d.text);v+=t?this.renderer.paragraph(p):p;continue;default:{const e='Token with "'+d.type+'" type was not found.';if(this.options.silent)return void console.error(e);throw new Error(e)}}return v}parseInline(e,t){t=t||this.renderer;let a,n,i,r="";const s=e.length;for(a=0;a<s;a++)if(n=e[a],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]&&(i=this.options.extensions.renderers[n.type].call({parser:this},n),!1!==i||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(n.type)))r+=i||"";else switch(n.type){case"escape":case"text":r+=t.text(n.text);break;case"html":r+=t.html(n.text);break;case"link":r+=t.link(n.href,n.title,this.parseInline(n.tokens,t));break;case"image":r+=t.image(n.href,n.title,n.text);break;case"strong":r+=t.strong(this.parseInline(n.tokens,t));break;case"em":r+=t.em(this.parseInline(n.tokens,t));break;case"codespan":r+=t.codespan(n.text);break;case"br":r+=t.br();break;case"del":r+=t.del(this.parseInline(n.tokens,t));break;default:{const e='Token with "'+n.type+'" type was not found.';if(this.options.silent)return void console.error(e);throw new Error(e)}}return r}}class marked_esm_Hooks{constructor(e){this.options=e||S}static passThroughHooks=new Set(["preprocess","postprocess"]);preprocess(e){return e}postprocess(e){return e}}const V=new class Marked{defaults={async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1};options=this.setOptions;parse=this.#e(Lexer.lex,Parser.parse);parseInline=this.#e(Lexer.lexInline,Parser.parseInline);Parser=Parser;parser=Parser.parse;Renderer=Renderer;TextRenderer=TextRenderer;Lexer=Lexer;lexer=Lexer.lex;Tokenizer=Tokenizer;Slugger=Slugger;Hooks=marked_esm_Hooks;constructor(...e){this.use(...e)}walkTokens(e,t){let a=[];for(const n of e)switch(a=a.concat(t.call(this,n)),n.type){case"table":for(const e of n.header)a=a.concat(this.walkTokens(e.tokens,t));for(const e of n.rows)for(const n of e)a=a.concat(this.walkTokens(n.tokens,t));break;case"list":a=a.concat(this.walkTokens(n.items,t));break;default:this.defaults.extensions&&this.defaults.extensions.childTokens&&this.defaults.extensions.childTokens[n.type]?this.defaults.extensions.childTokens[n.type].forEach((e=>{a=a.concat(this.walkTokens(n[e],t))})):n.tokens&&(a=a.concat(this.walkTokens(n.tokens,t)))}return a}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach((e=>{const a={...e};if(a.async=this.defaults.async||a.async||!1,e.extensions&&(e.extensions.forEach((e=>{if(!e.name)throw new Error("extension name required");if(e.renderer){const a=t.renderers[e.name];t.renderers[e.name]=a?function(...t){let n=e.renderer.apply(this,t);return!1===n&&(n=a.apply(this,t)),n}:e.renderer}if(e.tokenizer){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");t[e.level]?t[e.level].unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),a.extensions=t),e.renderer){const t=this.defaults.renderer||new Renderer(this.defaults);for(const a in e.renderer){const n=t[a];t[a]=(...i)=>{let r=e.renderer[a].apply(t,i);return!1===r&&(r=n.apply(t,i)),r}}a.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new Tokenizer(this.defaults);for(const a in e.tokenizer){const n=t[a];t[a]=(...i)=>{let r=e.tokenizer[a].apply(t,i);return!1===r&&(r=n.apply(t,i)),r}}a.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new marked_esm_Hooks;for(const a in e.hooks){const n=t[a];marked_esm_Hooks.passThroughHooks.has(a)?t[a]=i=>{if(this.defaults.async)return Promise.resolve(e.hooks[a].call(t,i)).then((e=>n.call(t,e)));const r=e.hooks[a].call(t,i);return n.call(t,r)}:t[a]=(...i)=>{let r=e.hooks[a].apply(t,i);return!1===r&&(r=n.apply(t,i)),r}}a.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens;a.walkTokens=function(a){let n=[];return n.push(e.walkTokens.call(this,a)),t&&(n=n.concat(t.call(this,a))),n}}this.defaults={...this.defaults,...a}})),this}setOptions(e){return this.defaults={...this.defaults,...e},this}#e(e,t){return(a,n,i)=>{"function"==typeof n&&(i=n,n=null);const r={...n};n={...this.defaults,...r};const s=this.#t(n.silent,n.async,i);if(null==a)return s(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof a)return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(a)+", string expected"));if(function(e,t){e&&!e.silent&&(t&&console.warn("marked(): callback is deprecated since version 5.0.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/using_pro#async"),(e.sanitize||e.sanitizer)&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options"),(e.highlight||"language-"!==e.langPrefix)&&console.warn("marked(): highlight and langPrefix parameters are deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-highlight."),e.mangle&&console.warn("marked(): mangle parameter is enabled by default, but is deprecated since version 5.0.0, and will be removed in the future. To clear this warning, install https://www.npmjs.com/package/marked-mangle, or disable by setting `{mangle: false}`."),e.baseUrl&&console.warn("marked(): baseUrl parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-base-url."),e.smartypants&&console.warn("marked(): smartypants parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-smartypants."),e.xhtml&&console.warn("marked(): xhtml parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-xhtml."),(e.headerIds||e.headerPrefix)&&console.warn("marked(): headerIds and headerPrefix parameters enabled by default, but are deprecated since version 5.0.0, and will be removed in the future. To clear this warning, install  https://www.npmjs.com/package/marked-gfm-heading-id, or disable by setting `{headerIds: false}`."))}(n,i),n.hooks&&(n.hooks.options=n),i){const r=n.highlight;let o;try{n.hooks&&(a=n.hooks.preprocess(a)),o=e(a,n)}catch(e){return s(e)}const l=e=>{let a;if(!e)try{n.walkTokens&&this.walkTokens(o,n.walkTokens),a=t(o,n),n.hooks&&(a=n.hooks.postprocess(a))}catch(t){e=t}return n.highlight=r,e?s(e):i(null,a)};if(!r||r.length<3)return l();if(delete n.highlight,!o.length)return l();let c=0;return this.walkTokens(o,(e=>{"code"===e.type&&(c++,setTimeout((()=>{r(e.text,e.lang,((t,a)=>{if(t)return l(t);null!=a&&a!==e.text&&(e.text=a,e.escaped=!0),c--,0===c&&l()}))}),0))})),void(0===c&&l())}if(n.async)return Promise.resolve(n.hooks?n.hooks.preprocess(a):a).then((t=>e(t,n))).then((e=>n.walkTokens?Promise.all(this.walkTokens(e,n.walkTokens)).then((()=>e)):e)).then((e=>t(e,n))).then((e=>n.hooks?n.hooks.postprocess(e):e)).catch(s);try{n.hooks&&(a=n.hooks.preprocess(a));const i=e(a,n);n.walkTokens&&this.walkTokens(i,n.walkTokens);let r=t(i,n);return n.hooks&&(r=n.hooks.postprocess(r)),r}catch(e){return s(e)}}}#t(e,t,a){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+E(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):a?void a(null,e):e}if(t)return Promise.reject(n);if(!a)throw n;a(n)}}}(S);function ee(e,t,a){return V.parse(e,t,a)}ee.options=ee.setOptions=function(e){return V.setOptions(e),ee.defaults=V.defaults,T(ee.defaults),ee},ee.getDefaults=_,ee.defaults=S,ee.use=function(...e){return V.use(...e),ee.defaults=V.defaults,T(ee.defaults),ee},ee.walkTokens=function(e,t){return V.walkTokens(e,t)},ee.parseInline=V.parseInline,ee.Parser=Parser,ee.parser=Parser.parse,ee.Renderer=Renderer,ee.TextRenderer=TextRenderer,ee.Lexer=Lexer,ee.lexer=Lexer.lex,ee.Tokenizer=Tokenizer,ee.Slugger=Slugger,ee.Hooks=marked_esm_Hooks,ee.parse=ee;ee.options,ee.setOptions,ee.use,ee.walkTokens,ee.parseInline;class StuntItem extends BaseItem{static async getActorSheetData(e){if(CONFIG.FateX.global.useMarkdown)for(const t of e.stunts)t.system.markdown=ee(t.data.description);for(const t of e.stunts)t.system.description=await TextEditor.enrichHTML(t.system.description,{async:!0});return e}static async getSheetData(e){e.enrichedDescription=await TextEditor.enrichHTML(e.system.description,{async:!0})}static activateActorSheetListeners(e,t){super.activateActorSheetListeners(e,t),e.find(".fatex-js-item-collapse").click((e=>this._onCollapseToggle.call(this,e,t)))}static async _onCollapseToggle(e,t){e.preventDefault();const a=e.currentTarget.dataset,n=t.actor.items.get(a.item);n&&await n.update({"system.collapsed":!n.system.collapsed},{})}}StuntItem.documentName="stunt";class FateRollsArrayField extends foundry.data.fields.ArrayField{_validateSpecial(e){if(super._validateSpecial(e),0===e.length)throw new Error("Rolls array must contain at least one roll")}}class FateRollHistoryDataModel extends foundry.abstract.DataModel{static defineSchema(){return{user:new foundry.data.fields.StringField({required:!0,blank:!1}),type:new foundry.data.fields.StringField({required:!0,blank:!1,choices:["reroll","increase"]}),timestamp:new foundry.data.fields.NumberField({required:!0,nullable:!1,initial:Date.now}),previousRoll:new foundry.data.fields.ArrayField(new foundry.data.fields.NumberField({required:!0,blank:!1}),{required:!1,blank:!1})}}get previousRollTotal(){const e=this.previousRoll.reduce(((e,t)=>e+t),0);return e>=0?`+${e}`:e}get message(){switch(this.type){case"reroll":return game.i18n.format("FAx.ChatCard.History.Reroll",{previous:this.previousRollTotal});case"increase":return game.i18n.localize("FAx.ChatCard.History.Increase")}}}class FateRollDataModel extends foundry.abstract.DataModel{static defineSchema(){return{id:new foundry.data.fields.StringField({required:!0,blank:!1}),name:new foundry.data.fields.StringField({required:!0,blank:!1}),rank:new foundry.data.fields.NumberField({required:!0,blank:!1}),bonus:new foundry.data.fields.NumberField({required:!0,blank:!1,default:0}),faces:new foundry.data.fields.ArrayField(new foundry.data.fields.NumberField({required:!0,blank:!1}),{required:!0,blank:!1}),history:new foundry.data.fields.ArrayField(new foundry.data.fields.EmbeddedDataField(FateRollHistoryDataModel),{required:!1}),options:new foundry.data.fields.ObjectField({required:!1,blank:!1})}}static migrateData(e){return"_id"in e&&(e.id=e._id,delete e._id),super.migrateData(e)}}const te="4dF",ae="1d6-1d6";class FateRoll extends FateRollDataModel{static createFromSkill(e,{magic:t=!1}={}){const a={magic:t,actor:e.actor};return(!game.settings.get("fatex","guildCodexMagicSystemEnabled")||!t||(a.magicCount=this.determineMagicCount(e),!1!==a.magicCount))&&(game.settings.get("fatex","enable2d6RollMode")&&!t&&(a.rollmode=ae),new FateRoll({id:foundry.utils.randomID(),name:e.name,rank:e.system.rank,options:a}))}async roll(e=""){var t,a;if(game.settings.get("fatex","guildCodexMagicSystemEnabled")&&this.options.magic&&this.options.magicCount>0)return this.rollMagic(e,this.options.magicCount);const n=null!==(t=this.options.rollmode)&&void 0!==t?t:te,i=new Roll(n),r=await i.evaluate();if(this.is2d6Roll?this.updateSource({faces:[...r.terms[0].results,...r.terms[2].results].map((e=>{var t;return null!==(t=e.count)&&void 0!==t?t:e.result}))}):this.updateSource({faces:r.terms[0].results.map((e=>{var t;return null!==(t=e.count)&&void 0!==t?t:e.result}))}),null===(a=game.modules.get("dice-so-nice"))||void 0===a?void 0:a.active){const t=e?game.users.get(e):game.user;await game.dice3d.showForRoll(r,t,!0)}return Hooks.callAll("fatex.roll",this),this}async rollMagic(e="",t){var a;const n=new Roll(`${t}dM + ${4-t}dF`),i=await n.evaluate();if(this.updateSource({faces:[...i.terms[0].results,...i.terms[2].results].map((e=>{var t;return null!==(t=e.count)&&void 0!==t?t:e.result}))}),null===(a=game.modules.get("dice-so-nice"))||void 0===a?void 0:a.active){const t=e?game.users.get(e):game.user;await game.dice3d.showForRoll(i,t,!0)}return Hooks.callAll("fatex.rollMagic",this),this}async reroll(e="",{shiftKey:t}){const a=this.addHistoryEntry(e,{type:"reroll",previousRoll:this.faces});return await this.roll(e),this.updateSource({history:a}),Hooks.callAll("fatex.reroll",this,{userId:e,shiftKey:t}),this}increase(e="",{shiftKey:t}){const a=this.addHistoryEntry(e,{type:"increase"});return this.updateSource({bonus:this.bonus+2,history:a}),Hooks.callAll("fatex.increase",this,{userId:e,shiftKey:t}),this}addHistoryEntry(e,t){var a;const n=foundry.utils.deepClone(null!==(a=this.history)&&void 0!==a?a:[]),i={user:(e?game.users.get(e):game.user).name,...t};return n.push(i),n}get total(){return this.is2d6Roll?this.faces[0]-this.faces[1]+this.rank+this.bonus:this.faces.reduce(((e,t)=>e+t),0)+this.rank+this.bonus}get ladder(){const e=Math.clamp(this.total,-4,8),t=(e<0?"-":"+").concat(Math.abs(e).toString());return game.i18n.localize(`FAx.Global.Ladder.${t}`)}get totalString(){return(this.total<0?"-":"+").concat(Math.abs(this.total).toString())}get symbols(){return this.is2d6Roll?this.faces:this.faces.map((e=>e>0?"+":e<0?"-":"0"))}get is2d6Roll(){return this.options.rollmode===ae}get rankStatus(){return this.rank>=0?"positive":"negative"}async render(){return await renderTemplate("systems/fatex/templates/chat/roll.hbs",this)}static determineMagicCount(e){var t;const a=e.parent.items.filter((e=>"skill"===e.type&&e.system.options.isMagicSkill));if(0===a.length)return ui.notifications.error(game.i18n.localize("FAx.Item.Skill.Roll.NoMagicSkills")),!1;a.length>1&&ui.notifications.warn(game.i18n.format("FAx.Item.Skill.Roll.MultipleMagicSkills",{skills:a.map((e=>e.name)).join(", ")}));const n=Math.clamped(Number(null!==(t=a[0].system.rank)&&void 0!==t?t:0),0,4);return n<1?(ui.notifications.error(game.i18n.localize("FAx.Item.Skill.Roll.MagicSkillTooLow")),!1):n}}class FateChatCardDataModel extends foundry.abstract.DataModel{static defineSchema(){return{messageId:new foundry.data.fields.StringField({required:!1,blank:!0}),speaker:new foundry.data.fields.ObjectField({required:!0,blank:!1}),rolls:new FateRollsArrayField(new foundry.data.fields.EmbeddedDataField(FateRoll,{required:!0,nullable:!1}),{required:!0,nullable:!1,initial:[]}),options:new foundry.data.fields.ObjectField({required:!1,nullable:!0})}}static migrateData(e){const t=this.schema;for(const[a,n]of Object.entries(e)){const i=t.get(a);i&&(i instanceof foundry.data.fields.EmbeddedDataField?e[a]=i.model.migrateDataSafe(n||{}):i instanceof foundry.data.fields.ArrayField&&i.element instanceof foundry.data.fields.EmbeddedDataField&&(n||[]).forEach((e=>i.element.model.migrateDataSafe(e))))}return e}}class FateChatCard extends FateChatCardDataModel{static create(e,t,a={}){const n=ChatMessage.getSpeaker({actor:e});return new FateChatCard({speaker:n,rolls:t,options:a})}async sendToChat(){var e;const t=await this.render(),a={user:null===(e=game.user)||void 0===e?void 0:e.id,speaker:this.speaker,rollMode:game.settings.get("core","rollMode"),content:t,flags:{fatex:{chatCard:this.toObject(!1)}}};ChatMessage.applyRollMode(a,game.settings.get("core","rollMode"));const n=await ChatMessage.create(a);this.updateSource({messageId:n.id}),await this.updateMessage()}async updateMessage(){const e=this.getMessage();if(!e)return void ui.notifications.warn(game.i18n.localize("FAx.ChatCard.MessageNotFound"));const t=await this.render();return await e.update({content:t,flags:{fatex:{chatCard:this.toObject(!1)}}})}getMessage(){var e;return null===(e=game.messages)||void 0===e?void 0:e.get(this.messageId)}async render(){const e=await Promise.all(this.rolls.map((e=>e.render())));return await renderTemplate("systems/fatex/templates/chat/chat-card.hbs",{rolls:e})}}const ne=1,ie=2;class StressItem extends BaseItem{static get documentName(){return"stress"}static activateActorSheetListeners(e,t){super.activateActorSheetListeners(e,t),e.find(".fatex-js-stress-checkbox").click((e=>this._onStressBoxToggle.call(this,e,t)))}static prepareItemData(e,t){let a=parseInt(e.system.size)+Automation.getBoxAmountModifier(t);return a<0&&(a=0),e.boxes=[...Array(a).keys()].map((t=>({isChecked:e.system.value&2**t,label:this._getBoxLabel(e,t)}))),e.fillers=a%4==0?[]:[...Array(4-a%4).keys()],t.isOwned&&(e.isDisabled=a<=0||Automation.getDisabledState(t)),e}static _getBoxLabel(e,t){return e.system.labelType===ne?"1":e.system.labelType===ie?e.system.customLabel.split(" ")[t]:t+1}static _getToggledStressValue(e,t){return e^2**t}static _onStressBoxToggle(e,t){e.preventDefault();const a=e.currentTarget.dataset,n=t.actor.items.get(a.item),i=a.index;if(n){const e=StressItem._getToggledStressValue(n.system.value,i);n.update({"system.value":e},{})}}}class FateItem extends Item{prepareData(){var e;super.prepareData(),(null===(e=this.actor)||void 0===e?void 0:e.system)&&CONFIG.FateX.itemClasses[this.type]&&CONFIG.FateX.itemClasses[this.type].prepareItemData(this,this)}get visible(){return!this.isSubitem()&&super.visible}isSubitem(){return"extra"===this.type&&""!==this.system.parentID}}class SubItems extends BaseComponent{static activateListeners(e,t){e.find("#create-sub-item").click((e=>this._onCreateSubItem.call(this,e,t))),e.find(".fatex-js-subitem-delete").click((e=>this._onItemDelete.call(this,e,t)))}static _onItemDelete(e,t){var a;e.preventDefault(),e.stopPropagation();const n=e.currentTarget.dataset,i=null===(a=game.items)||void 0===a?void 0:a.get(n.item);null==i||i.delete().then((()=>{t.render()}))}static async getSheetData(e,t){var a;return e.subItems=null===(a=game.items)||void 0===a?void 0:a.contents.filter((e=>"extra"==e.system.type&&e.system.parentID==t.document.id)),console.log(e),e}static _onCreateSubItem(e,t){const a={type:"extra",name:"Test-Sub-Item",system:{description:"",parentID:t.document.id}};console.log("Create new sub item"),FateItem.create(a).then((()=>t.render()))}}const re={itemClasses:{stress:StressItem,aspect:AspectItem,consequence:ConsequenceItem,skill:class SkillItem extends BaseItem{static get documentName(){return"skill"}static activateActorSheetListeners(e,t){super.activateActorSheetListeners(e,t),e.find(".fatex-js-skill").click((e=>this._onRollSkill.call(this,e,t))),e.find(".fatex-js-skill-increment").click((e=>this._onSkillChangeRank.call(this,e,t,!0))),e.find(".fatex-js-skill-decrement").click((e=>this._onSkillChangeRank.call(this,e,t,!1))),e.find(`.fatex-js-${this.documentName}-sort-rank`).click((()=>this._onSkillSort.call(this,t,"rank"))),e.find(`.fatex-js-${this.documentName}-sort-name`).click((()=>this._onSkillSort.call(this,t,"name"))),e.find(`.fatex-js-${this.documentName}-sort-reverse`).click((()=>this._onSkillSort.call(this,t,"reverse")))}static async getActorSheetData(e){if(e.options.enableColumns=e.skills.length>=8,e.options.enableColumns){const t=([e,...a],n=[])=>void 0===e?n:[e,...t(n,a)],a=Math.ceil(e.skills.length/2);e.skills=t(e.skills.slice(0,a),e.skills.slice(a))}return e}static prepareItemData(e,t){return e.system.isNegative=e.system.rank<0,e.system.isPositive=e.system.rank>=0,e.system.isNeutral=0===e.system.rank,e}static async getSheetData(e,t){e.availableRanks=[];for(let t=-2;t<=7;t++)e.availableRanks.push(t);return e}static async _onSkillSort(e,t){const a=e.actor.items.filter((e=>"skill"==e.type));"name"===t?a.sort(((e,t)=>e.name.localeCompare(t.name))):"rank"===t?a.sort(((e,t)=>e.system.rank-t.system.rank)).reverse():"reverse"===t&&a.sort(((e,t)=>e.sort-t.sort)).reverse();let n=0;const i=a.map((e=>({_id:e.id,sort:1e4+n++})));e.actor.updateEmbeddedDocuments("Item",i)}static async _onSkillChangeRank(e,t,a){e.preventDefault(),e.stopPropagation();const n=e.currentTarget.dataset,i=t.actor.items.get(n.item);if(i){const e=i.system.rank;await i.update({"system.rank":a?e+1:e-1},{})}}static async _onRollSkill(e,t){if(e.preventDefault(),this.isEditMode(e))return;const a=e.currentTarget.dataset,n=t.actor.items.get(a.itemId);n&&await this.rollSkill(t,n,e)}static async rollSkill(e,t,a){const n=e.actor,i=FateRoll.createFromSkill(t,{magic:a.shiftKey});if(!i)return;i.roll();const r=FateChatCard.create(n,[i]);await r.sendToChat()}},stunt:StuntItem,extra:class ExtraItem extends StuntItem{static get documentName(){return"extra"}static async getActorSheetData(e){e=await StuntItem.getActorSheetData(e);for(const t of e.extras)t.system.description=await TextEditor.enrichHTML(t.system.description,{async:!0});return e}static async getSheetData(e){e.enrichedDescription=await TextEditor.enrichHTML(e.system.description,{async:!0})}},tokenRefernce:class TokenReferenceItem extends BaseItem{static get documentName(){return"tokenReference"}},actorReference:class ActorReferenceItem extends BaseItem{static get documentName(){return"actorReference"}}},sheetComponents:{actor:{sortable:class Sortable extends BaseComponent{static activateListeners(e,t){e.find(".fatex-js-sortable").each(((e,a)=>{a.addEventListener("dragstart",(e=>t._onDragStart.call(t,e)),!1)})),e.find(".fatex-js-item-sort").mousedown((e=>this._onDragHandlerMouseDown.call(this,e))),e.find(".fatex-js-item-sort").mouseup((e=>this._onDragHandlerMouseUp.call(this,e)))}static _onDragHandlerMouseDown(e){var t;null===(t=$(e.currentTarget).parents(".fatex-js-sortable").get(0))||void 0===t||t.setAttribute("draggable","true")}static _onDragHandlerMouseUp(e){var t;null===(t=$(e.currentTarget).parents(".fatex-js-sortable").get(0))||void 0===t||t.setAttribute("draggable","false")}},configuration:class Configuration extends BaseComponent{},subItems:SubItems},item:{radio:class Radio extends BaseComponent{static activateListeners(e,t){e.find(".fatex-js-radio-button").click((e=>this._onSettingsRadio.call(this,e,t)))}static _onSettingsRadio(e,t){e.preventDefault();const a=e.currentTarget.dataset,n=a.name,i=t.document;let r="";r="Number"===a.dtype?parseInt(a.value):a.value,i.update({[n]:r})}},rangeSlider:class RangeSlider extends BaseComponent{static activateListeners(e){e.find(".fatex-js-setting-range-value").on("change",(e=>this._onChangeRangeValue.call(this,e))),e.find(".fatex-js-setting-range-slider").on("input",(e=>this._onChangeRangeSlider.call(this,e)))}static _onChangeRangeSlider(e){e.preventDefault();e.currentTarget.previousElementSibling.value=e.currentTarget.value}static _onChangeRangeValue(e){e.preventDefault();e.currentTarget.nextElementSibling.value=e.currentTarget.value}},automation:Automation,subItems:SubItems}},applications:{templateSettings:null,templatePicker:null},global:{useMarkdown:!1}};class DataManager{async getAvailableSystems(){let e=game.i18n.lang,t=await fetch(`systems/fatex/data/${e}/systems.json`);200!==t.status&&(e="en",t=await fetch(`systems/fatex/data/${e}/systems.json`));return{lang:e,availableSystems:await t.json()}}async getSystems(){const{lang:e,availableSystems:t}=await this.getAvailableSystems();return Promise.all(t.map((async t=>await this.fetchSystemByName(e,t))))}async fetchSystemByName(e,t){const a=await fetch(`systems/fatex/data/${e}/systems/${t}.json`);return 200===a.status?await a.json():{}}}const se=0,oe=1,le=2,ce=3,pe=4,de={1:"aspect",2:"consequence",3:"skill",4:"stress"};class SheetSetup extends FormApplication{constructor(e,t){super(e,t),this.actor.apps[this.appId]=this}get actor(){return this.object}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{title:game.i18n.localize("FAx.Apps.Setup.Title"),template:"/systems/fatex/templates/apps/sheet-setup.hbs",resizable:!0,classes:["fatex","fatex-sheet","fatex-sheet--app"],width:600,height:700,scrollY:[".fatex-desk__content"],tabs:[{navSelector:".fatex-js-vertical-tabs-navigation",contentSelector:".fatex-js-vertical-tabs-content"}]})}async getData(){const e={options:this.options,isOwnedBy:!!this.actor&&this.actor.name,hasAspects:!!this.actor.items.filter((e=>"aspect"===e.type)).length,hasSkills:!!this.actor.items.filter((e=>"skill"===e.type)).length,hasConsequences:!!this.actor.items.filter((e=>"consequence"===e.type)).length,hasStress:!!this.actor.items.filter((e=>"stress"===e.type)).length,hasAny:!!this.actor.items.size},t=new DataManager;return e.systems=await t.getSystems(),e}activateListeners(e){super.activateListeners(e),e.find(".fatex-js-clear").click((e=>this._onClear.call(this,e,se))),e.find(".fatex-js-clear-stress").click((e=>this._onClear.call(this,e,pe))),e.find(".fatex-js-clear-skills").click((e=>this._onClear.call(this,e,ce))),e.find(".fatex-js-clear-consequences").click((e=>this._onClear.call(this,e,le))),e.find(".fatex-js-clear-aspects").click((e=>this._onClear.call(this,e,oe))),e.find(".fatex-js-add-selection").click((e=>this._onSetupType.call(this,e))),e.find(".fatex-js-toggle-selection").click((e=>this._onToggleType.call(this,e)))}async _onSetupType(e){e.preventDefault();const t=$(e.currentTarget).parents(".fatex-sheet-setup__section").first().find("input:checked");if(!t.length)return;const a=t.toArray().map((e=>{if(!e.dataset.document)return{};const t=JSON.parse(e.dataset.document);return t.system=t.data,t}));await this.actor.createEmbeddedDocuments("Item",a),this.render(!0)}async _onToggleType(e){e.preventDefault();const t=$(e.currentTarget).parents(".fatex-sheet-setup__section, .fatex-sheet-setup__group").first().find("input");t.prop("checked",!t.first().prop("checked"))}async _onClear(e,t){e.preventDefault(),void 0!==t&&new Dialog({title:game.i18n.localize("FAx.Dialog.ActorClear"),content:game.i18n.localize("FAx.Dialog.ActorClearText"),default:"cancel",buttons:{cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("FAx.Dialog.Cancel"),callback:()=>null},submit:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("FAx.Dialog.Confirm"),callback:async()=>{await this._doClear(t)}}}},{classes:["fatex","fatex-dialog"]}).render(!0)}async _doClear(e){let t;t=e>0?this.actor.items.filter((t=>t.type===de[e])):this.actor.items;const a=t.map((e=>e.id||""));await this.actor.deleteEmbeddedDocuments("Item",a),this.render(!0)}async _updateObject(){}}class CharacterSheet extends ActorSheet{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{classes:["fatex","fatex-sheet","sheet"],tabs:[{navSelector:".fatex-js-tabs-navigation",contentSelector:".fatex-js-tab-content",initial:"skills"}],scrollY:[".fatex-desk__content"],width:900,type:"full"})}get template(){var e;return!(null===(e=game.user)||void 0===e?void 0:e.isGM)&&this.actor.limited?"systems/fatex/templates/actor/limited.hbs":"systems/fatex/templates/actor/character.hbs"}activateListeners(e){var t;super.activateListeners(e);for(const a in CONFIG.FateX.itemClasses)null===(t=CONFIG.FateX.itemClasses[a])||void 0===t||t.activateActorSheetListeners(e,this);for(const t in CONFIG.FateX.sheetComponents.actor)CONFIG.FateX.sheetComponents.actor[t].activateListeners(e,this)}async getData(){let e={owner:this.actor.isOwner,options:this.options,editable:this.isEditable,isTemplateActor:this.actor.isTemplateActor,isEmptyActor:!this.actor.items.size,isToken:this.token&&!this.token.actorLink,config:CONFIG.FateX};e.actor=foundry.utils.duplicate(this.actor),e.data=e.actor.system,e.items=this.actor.items.map((e=>e)),e.items.sort(((e,t)=>(e.sort||0)-(t.sort||0))),e.stress=e.items.filter((e=>"stress"===e.type)),e.aspects=e.items.filter((e=>"aspect"===e.type)),e.skills=e.items.filter((e=>"skill"===e.type)),e.stunts=e.items.filter((e=>"stunt"===e.type)),e.extras=e.items.filter((e=>"extra"===e.type)),e.consequences=e.items.filter((e=>"consequence"===e.type)),e.enrichedBiography=await TextEditor.enrichHTML(this.object.system.biography.value,{async:!0});for(const t in CONFIG.FateX.itemClasses)e=await CONFIG.FateX.itemClasses[t].getActorSheetData(e,this);return e}_getHeaderButtons(){var e;const t=super._getHeaderButtons(),a=(null===(e=game.user)||void 0===e?void 0:e.isGM)||this.actor.isOwner;return this.options.editable&&a&&t.unshift({class:"fatex-toggle-edit-mode",label:game.i18n.localize("FAx.Sheet.Buttons.EditMode"),icon:"fas fa-edit",onclick:e=>this._onToggleEditMode(e)},{class:"fatex-open-sheet-manager",label:game.i18n.localize("FAx.Sheet.Buttons.SheetSetup"),icon:"fas fa-tools",onclick:e=>this._onOpenSheetSetup(e)}),t}_onToggleEditMode(e){e.preventDefault();$(e.currentTarget).parents(".app").find(".window-content").toggleClass("fatex-js-edit-mode")}_onOpenSheetSetup(e){e.preventDefault();new SheetSetup(this.actor,{}).render(!0)}async _onDrop(e){var t,a;let n;try{n=JSON.parse(null!==(a=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text/plain"))&&void 0!==a?a:"")}catch(e){return}return"JournalEntry"===n.type?this._onDropJournalEntry(n):super._onDrop(e)}async _onDropJournalEntry(e){var t;const a=await JournalEntry.fromDropData(e),n=this.actor,i={type:"extra",document:null,name:null!==(t=null==a?void 0:a.data.name)&&void 0!==t?t:"",data:{description:(null==a?void 0:a.data.content)||""}};return await n.createEmbeddedDocuments("Item",[i])}async _render(e,t){var a;const n=this.element.find(":focus").data("focus-id"),i=window.getSelection(),r=null!==(a=null==i?void 0:i.focusOffset)&&void 0!==a?a:0;if(await super._render(e,t),n){const e=this.element.find(`[data-focus-id=${n}]`)[0],t=document.createRange();t.setStart(e.childNodes[0],r),t.collapse(!0),null==i||i.removeAllRanges(),null==i||i.addRange(t),e.focus()}}}class InlineActorSheetFate extends CharacterSheet{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{group:void 0,width:"auto",height:"auto",tabs:[{navSelector:".fatex-js-tabs-navigation",contentSelector:".fatex-js-tab-content",initial:"aspects"}]})}async getData(e){const t=await super.getData();return this.options.referenceID&&(t.referenceID=this.options.referenceID),this.options.combatant&&(t.defeated=this.options.combatant.data.defeated,t.hidden=this.options.combatant.data.hidden),t}get id(){return this.options.id?this.options.id:`inline-app-${this.appId}`}get popOut(){return!1}get template(){return"systems/fatex/templates/inline-sheet/character.hbs"}render(e=!1,t={}){return this.object.apps[this.appId]=this,this._render(e,t),this}_injectHTML(e,t={}){var a;const n=null!==(a=null==t?void 0:t.group)&&void 0!==a?a:this.options.group;$(`#${null==n?void 0:n.id} .fatex-js-actor-group-sheets`).append(e),this._element=e}}function fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ue(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(a),!0).forEach((function(t){me(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function me(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ge(){return ge=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ge.apply(this,arguments)}function xe(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function be(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var ke=be(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),ye=be(/Edge/i),ve=be(/firefox/i),we=be(/safari/i)&&!be(/chrome/i)&&!be(/android/i),_e=be(/iP(ad|od|hone)/i),Se=be(/chrome/i)&&be(/android/i),Te={capture:!1,passive:!1};function Ae(e,t,a){e.addEventListener(t,a,!ke&&Te)}function Ce(e,t,a){e.removeEventListener(t,a,!ke&&Te)}function De(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function Ie(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Fe(e,t,a,n){if(e){a=a||document;do{if(null!=t&&(">"===t[0]?e.parentNode===a&&De(e,t):De(e,t))||n&&e===a)return e;if(e===a)break}while(e=Ie(e))}return null}var Re,Ee=/\s+/g;function Oe(e,t,a){if(e&&t)if(e.classList)e.classList[a?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(Ee," ").replace(" "+t+" "," ");e.className=(n+(a?" "+t:"")).replace(Ee," ")}}function ze(e,t,a){var n=e&&e.style;if(n){if(void 0===a)return document.defaultView&&document.defaultView.getComputedStyle?a=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(a=e.currentStyle),void 0===t?a:a[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=a+("string"==typeof a?"":"px")}}function Ne(e,t){var a="";if("string"==typeof e)a=e;else do{var n=ze(e,"transform");n&&"none"!==n&&(a=n+" "+a)}while(!t&&(e=e.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(a)}function Me(e,t,a){if(e){var n=e.getElementsByTagName(t),i=0,r=n.length;if(a)for(;i<r;i++)a(n[i],i);return n}return[]}function $e(){var e=document.scrollingElement;return e||document.documentElement}function je(e,t,a,n,i){if(e.getBoundingClientRect||e===window){var r,s,o,l,c,p,d;if(e!==window&&e.parentNode&&e!==$e()?(s=(r=e.getBoundingClientRect()).top,o=r.left,l=r.bottom,c=r.right,p=r.height,d=r.width):(s=0,o=0,l=window.innerHeight,c=window.innerWidth,p=window.innerHeight,d=window.innerWidth),(t||a)&&e!==window&&(i=i||e.parentNode,!ke))do{if(i&&i.getBoundingClientRect&&("none"!==ze(i,"transform")||a&&"static"!==ze(i,"position"))){var f=i.getBoundingClientRect();s-=f.top+parseInt(ze(i,"border-top-width")),o-=f.left+parseInt(ze(i,"border-left-width")),l=s+r.height,c=o+r.width;break}}while(i=i.parentNode);if(n&&e!==window){var u=Ne(i||e),h=u&&u.a,m=u&&u.d;u&&(l=(s/=m)+(p/=m),c=(o/=h)+(d/=h))}return{top:s,left:o,bottom:l,right:c,width:d,height:p}}}function Pe(e,t,a){for(var n=Ge(e,!0),i=je(e)[t];n;){var r=je(n)[a];if(!("top"===a||"left"===a?i>=r:i<=r))return n;if(n===$e())break;n=Ge(n,!1)}return!1}function Le(e,t,a,n){for(var i=0,r=0,s=e.children;r<s.length;){if("none"!==s[r].style.display&&s[r]!==Zt.ghost&&(n||s[r]!==Zt.dragged)&&Fe(s[r],a.draggable,e,!1)){if(i===t)return s[r];i++}r++}return null}function Be(e,t){for(var a=e.lastElementChild;a&&(a===Zt.ghost||"none"===ze(a,"display")||t&&!De(a,t));)a=a.previousElementSibling;return a||null}function Xe(e,t){var a=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Zt.clone||t&&!De(e,t)||a++;return a}function He(e){var t=0,a=0,n=$e();if(e)do{var i=Ne(e),r=i.a,s=i.d;t+=e.scrollLeft*r,a+=e.scrollTop*s}while(e!==n&&(e=e.parentNode));return[t,a]}function Ge(e,t){if(!e||!e.getBoundingClientRect)return $e();var a=e,n=!1;do{if(a.clientWidth<a.scrollWidth||a.clientHeight<a.scrollHeight){var i=ze(a);if(a.clientWidth<a.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||a.clientHeight<a.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!a.getBoundingClientRect||a===document.body)return $e();if(n||t)return a;n=!0}}}while(a=a.parentNode);return $e()}function qe(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function Ue(e,t){return function(){if(!Re){var a=arguments;1===a.length?e.call(this,a[0]):e.apply(this,a),Re=setTimeout((function(){Re=void 0}),t)}}}function Ye(e,t,a){e.scrollLeft+=t,e.scrollTop+=a}function Ze(e){var t=window.Polymer,a=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):a?a(e).clone(!0)[0]:e.cloneNode(!0)}var Qe="Sortable"+(new Date).getTime();function Ke(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==ze(e,"display")&&e!==Zt.ghost){t.push({target:e,rect:je(e)});var a=ue({},t[t.length-1].rect);if(e.thisAnimationDuration){var n=Ne(e,!0);n&&(a.top-=n.f,a.left-=n.e)}e.fromRect=a}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var a in e)if(e.hasOwnProperty(a))for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e[a][n])return Number(a);return-1}(t,{target:e}),1)},animateAll:function(a){var n=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof a&&a());var i=!1,r=0;t.forEach((function(e){var t=0,a=e.target,s=a.fromRect,o=je(a),l=a.prevFromRect,c=a.prevToRect,p=e.rect,d=Ne(a,!0);d&&(o.top-=d.f,o.left-=d.e),a.toRect=o,a.thisAnimationDuration&&qe(l,o)&&!qe(s,o)&&(p.top-o.top)/(p.left-o.left)==(s.top-o.top)/(s.left-o.left)&&(t=function(e,t,a,n){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-a.top,2)+Math.pow(t.left-a.left,2))*n.animation}(p,l,c,n.options)),qe(o,s)||(a.prevFromRect=s,a.prevToRect=o,t||(t=n.options.animation),n.animate(a,p,o,t)),t&&(i=!0,r=Math.max(r,t),clearTimeout(a.animationResetTimer),a.animationResetTimer=setTimeout((function(){a.animationTime=0,a.prevFromRect=null,a.fromRect=null,a.prevToRect=null,a.thisAnimationDuration=null}),t),a.thisAnimationDuration=t)})),clearTimeout(e),i?e=setTimeout((function(){"function"==typeof a&&a()}),r):"function"==typeof a&&a(),t=[]},animate:function(e,t,a,n){if(n){ze(e,"transition",""),ze(e,"transform","");var i=Ne(this.el),r=i&&i.a,s=i&&i.d,o=(t.left-a.left)/(r||1),l=(t.top-a.top)/(s||1);e.animatingX=!!o,e.animatingY=!!l,ze(e,"transform","translate3d("+o+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),ze(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),ze(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){ze(e,"transition",""),ze(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),n)}}}}var We=[],Je={initializeByDefault:!0},Ve={mount:function(e){for(var t in Je)Je.hasOwnProperty(t)&&!(t in e)&&(e[t]=Je[t]);We.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),We.push(e)},pluginEvent:function(e,t,a){var n=this;this.eventCanceled=!1,a.cancel=function(){n.eventCanceled=!0};var i=e+"Global";We.forEach((function(n){t[n.pluginName]&&(t[n.pluginName][i]&&t[n.pluginName][i](ue({sortable:t},a)),t.options[n.pluginName]&&t[n.pluginName][e]&&t[n.pluginName][e](ue({sortable:t},a)))}))},initializePlugins:function(e,t,a,n){for(var i in We.forEach((function(n){var i=n.pluginName;if(e.options[i]||n.initializeByDefault){var r=new n(e,t,e.options);r.sortable=e,r.options=e.options,e[i]=r,ge(a,r.defaults)}})),e.options)if(e.options.hasOwnProperty(i)){var r=this.modifyOption(e,i,e.options[i]);void 0!==r&&(e.options[i]=r)}},getEventProperties:function(e,t){var a={};return We.forEach((function(n){"function"==typeof n.eventProperties&&ge(a,n.eventProperties.call(t[n.pluginName],e))})),a},modifyOption:function(e,t,a){var n;return We.forEach((function(i){e[i.pluginName]&&i.optionListeners&&"function"==typeof i.optionListeners[t]&&(n=i.optionListeners[t].call(e[i.pluginName],a))})),n}};function et(e){var t=e.sortable,a=e.rootEl,n=e.name,i=e.targetEl,r=e.cloneEl,s=e.toEl,o=e.fromEl,l=e.oldIndex,c=e.newIndex,p=e.oldDraggableIndex,d=e.newDraggableIndex,f=e.originalEvent,u=e.putSortable,h=e.extraEventProperties;if(t=t||a&&a[Qe]){var m,g=t.options,x="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||ke||ye?(m=document.createEvent("Event")).initEvent(n,!0,!0):m=new CustomEvent(n,{bubbles:!0,cancelable:!0}),m.to=s||a,m.from=o||a,m.item=i||a,m.clone=r,m.oldIndex=l,m.newIndex=c,m.oldDraggableIndex=p,m.newDraggableIndex=d,m.originalEvent=f,m.pullMode=u?u.lastPutMode:void 0;var b=ue(ue({},h),Ve.getEventProperties(n,t));for(var k in b)m[k]=b[k];a&&a.dispatchEvent(m),g[x]&&g[x].call(t,m)}}var tt=["evt"],at=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.evt,i=xe(a,tt);Ve.pluginEvent.bind(Zt)(e,t,ue({dragEl:it,parentEl:rt,ghostEl:st,rootEl:ot,nextEl:lt,lastDownEl:ct,cloneEl:pt,cloneHidden:dt,dragStarted:St,putSortable:xt,activeSortable:Zt.active,originalEvent:n,oldIndex:ft,oldDraggableIndex:ht,newIndex:ut,newDraggableIndex:mt,hideGhostForTarget:Gt,unhideGhostForTarget:qt,cloneNowHidden:function(){dt=!0},cloneNowShown:function(){dt=!1},dispatchSortableEvent:function(e){nt({sortable:t,name:e,originalEvent:n})}},i))};function nt(e){et(ue({putSortable:xt,cloneEl:pt,targetEl:it,rootEl:ot,oldIndex:ft,oldDraggableIndex:ht,newIndex:ut,newDraggableIndex:mt},e))}var it,rt,st,ot,lt,ct,pt,dt,ft,ut,ht,mt,gt,xt,bt,kt,yt,vt,wt,_t,St,Tt,At,Ct,Dt,It=!1,Ft=!1,Rt=[],Et=!1,Ot=!1,zt=[],Nt=!1,Mt=[],$t="undefined"!=typeof document,jt=_e,Pt=ye||ke?"cssFloat":"float",Lt=$t&&!Se&&!_e&&"draggable"in document.createElement("div"),Bt=function(){if($t){if(ke)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Xt=function(e,t){var a=ze(e),n=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),i=Le(e,0,t),r=Le(e,1,t),s=i&&ze(i),o=r&&ze(r),l=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+je(i).width,c=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+je(r).width;if("flex"===a.display)return"column"===a.flexDirection||"column-reverse"===a.flexDirection?"vertical":"horizontal";if("grid"===a.display)return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&s.float&&"none"!==s.float){var p="left"===s.float?"left":"right";return!r||"both"!==o.clear&&o.clear!==p?"horizontal":"vertical"}return i&&("block"===s.display||"flex"===s.display||"table"===s.display||"grid"===s.display||l>=n&&"none"===a[Pt]||r&&"none"===a[Pt]&&l+c>n)?"vertical":"horizontal"},Ht=function(e){function t(e,a){return function(n,i,r,s){var o=n.options.group.name&&i.options.group.name&&n.options.group.name===i.options.group.name;if(null==e&&(a||o))return!0;if(null==e||!1===e)return!1;if(a&&"clone"===e)return e;if("function"==typeof e)return t(e(n,i,r,s),a)(n,i,r,s);var l=(a?n:i).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var a={},n=e.group;n&&"object"==he(n)||(n={name:n}),a.name=n.name,a.checkPull=t(n.pull,!0),a.checkPut=t(n.put),a.revertClone=n.revertClone,e.group=a},Gt=function(){!Bt&&st&&ze(st,"display","none")},qt=function(){!Bt&&st&&ze(st,"display","")};$t&&!Se&&document.addEventListener("click",(function(e){if(Ft)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Ft=!1,!1}),!0);var Ut=function(e){if(it){e=e.touches?e.touches[0]:e;var t=(i=e.clientX,r=e.clientY,Rt.some((function(e){var t=e[Qe].options.emptyInsertThreshold;if(t&&!Be(e)){var a=je(e),n=i>=a.left-t&&i<=a.right+t,o=r>=a.top-t&&r<=a.bottom+t;return n&&o?s=e:void 0}})),s);if(t){var a={};for(var n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);a.target=a.rootEl=t,a.preventDefault=void 0,a.stopPropagation=void 0,t[Qe]._onDragOver(a)}}var i,r,s},Yt=function(e){it&&it.parentNode[Qe]._isOutsideThisEl(e.target)};function Zt(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=ge({},t),e[Qe]=this;var a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Xt(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Zt.supportPointer&&"PointerEvent"in window&&!we,emptyInsertThreshold:5};for(var n in Ve.initializePlugins(this,e,a),a)!(n in t)&&(t[n]=a[n]);for(var i in Ht(t),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=!t.forceFallback&&Lt,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?Ae(e,"pointerdown",this._onTapStart):(Ae(e,"mousedown",this._onTapStart),Ae(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(Ae(e,"dragover",this),Ae(e,"dragenter",this)),Rt.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),ge(this,Ke())}function Qt(e,t,a,n,i,r,s,o){var l,c,p=e[Qe],d=p.options.onMove;return!window.CustomEvent||ke||ye?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=a,l.draggedRect=n,l.related=i||t,l.relatedRect=r||je(t),l.willInsertAfter=o,l.originalEvent=s,e.dispatchEvent(l),d&&(c=d.call(p,l,s)),c}function Kt(e){e.draggable=!1}function Wt(){Nt=!1}function Jt(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,a=t.length,n=0;a--;)n+=t.charCodeAt(a);return n.toString(36)}function Vt(e){return setTimeout(e,0)}function ea(e){return clearTimeout(e)}Zt.prototype={constructor:Zt,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Tt=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,it):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,a=this.el,n=this.options,i=n.preventOnFilter,r=e.type,s=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,o=(s||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||o,c=n.filter;if(function(e){Mt.length=0;var t=e.getElementsByTagName("input"),a=t.length;for(;a--;){var n=t[a];n.checked&&Mt.push(n)}}(a),!it&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||n.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!we||!o||"SELECT"!==o.tagName.toUpperCase())&&!((o=Fe(o,n.draggable,a,!1))&&o.animated||ct===o)){if(ft=Xe(o),ht=Xe(o,n.draggable),"function"==typeof c){if(c.call(this,e,o,this))return nt({sortable:t,rootEl:l,name:"filter",targetEl:o,toEl:a,fromEl:a}),at("filter",t,{evt:e}),void(i&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(n){if(n=Fe(l,n.trim(),a,!1))return nt({sortable:t,rootEl:n,name:"filter",targetEl:o,fromEl:a,toEl:a}),at("filter",t,{evt:e}),!0}))))return void(i&&e.cancelable&&e.preventDefault());n.handle&&!Fe(l,n.handle,a,!1)||this._prepareDragStart(e,s,o)}}},_prepareDragStart:function(e,t,a){var n,i=this,r=i.el,s=i.options,o=r.ownerDocument;if(a&&!it&&a.parentNode===r){var l=je(a);if(ot=r,rt=(it=a).parentNode,lt=it.nextSibling,ct=a,gt=s.group,Zt.dragged=it,bt={target:it,clientX:(t||e).clientX,clientY:(t||e).clientY},wt=bt.clientX-l.left,_t=bt.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,it.style["will-change"]="all",n=function(){at("delayEnded",i,{evt:e}),Zt.eventCanceled?i._onDrop():(i._disableDelayedDragEvents(),!ve&&i.nativeDraggable&&(it.draggable=!0),i._triggerDragStart(e,t),nt({sortable:i,name:"choose",originalEvent:e}),Oe(it,s.chosenClass,!0))},s.ignore.split(",").forEach((function(e){Me(it,e.trim(),Kt)})),Ae(o,"dragover",Ut),Ae(o,"mousemove",Ut),Ae(o,"touchmove",Ut),Ae(o,"mouseup",i._onDrop),Ae(o,"touchend",i._onDrop),Ae(o,"touchcancel",i._onDrop),ve&&this.nativeDraggable&&(this.options.touchStartThreshold=4,it.draggable=!0),at("delayStart",this,{evt:e}),!s.delay||s.delayOnTouchOnly&&!t||this.nativeDraggable&&(ye||ke))n();else{if(Zt.eventCanceled)return void this._onDrop();Ae(o,"mouseup",i._disableDelayedDrag),Ae(o,"touchend",i._disableDelayedDrag),Ae(o,"touchcancel",i._disableDelayedDrag),Ae(o,"mousemove",i._delayedDragTouchMoveHandler),Ae(o,"touchmove",i._delayedDragTouchMoveHandler),s.supportPointer&&Ae(o,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(n,s.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){it&&Kt(it),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;Ce(e,"mouseup",this._disableDelayedDrag),Ce(e,"touchend",this._disableDelayedDrag),Ce(e,"touchcancel",this._disableDelayedDrag),Ce(e,"mousemove",this._delayedDragTouchMoveHandler),Ce(e,"touchmove",this._delayedDragTouchMoveHandler),Ce(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?Ae(document,"pointermove",this._onTouchMove):Ae(document,t?"touchmove":"mousemove",this._onTouchMove):(Ae(it,"dragend",this),Ae(ot,"dragstart",this._onDragStart));try{document.selection?Vt((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(It=!1,ot&&it){at("dragStarted",this,{evt:t}),this.nativeDraggable&&Ae(document,"dragover",Yt);var a=this.options;!e&&Oe(it,a.dragClass,!1),Oe(it,a.ghostClass,!0),Zt.active=this,e&&this._appendGhost(),nt({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(kt){this._lastX=kt.clientX,this._lastY=kt.clientY,Gt();for(var e=document.elementFromPoint(kt.clientX,kt.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(kt.clientX,kt.clientY))!==t;)t=e;if(it.parentNode[Qe]._isOutsideThisEl(e),t)do{if(t[Qe]){if(t[Qe]._onDragOver({clientX:kt.clientX,clientY:kt.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);qt()}},_onTouchMove:function(e){if(bt){var t=this.options,a=t.fallbackTolerance,n=t.fallbackOffset,i=e.touches?e.touches[0]:e,r=st&&Ne(st,!0),s=st&&r&&r.a,o=st&&r&&r.d,l=jt&&Dt&&He(Dt),c=(i.clientX-bt.clientX+n.x)/(s||1)+(l?l[0]-zt[0]:0)/(s||1),p=(i.clientY-bt.clientY+n.y)/(o||1)+(l?l[1]-zt[1]:0)/(o||1);if(!Zt.active&&!It){if(a&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<a)return;this._onDragStart(e,!0)}if(st){r?(r.e+=c-(yt||0),r.f+=p-(vt||0)):r={a:1,b:0,c:0,d:1,e:c,f:p};var d="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");ze(st,"webkitTransform",d),ze(st,"mozTransform",d),ze(st,"msTransform",d),ze(st,"transform",d),yt=c,vt=p,kt=i}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!st){var e=this.options.fallbackOnBody?document.body:ot,t=je(it,!0,jt,!0,e),a=this.options;if(jt){for(Dt=e;"static"===ze(Dt,"position")&&"none"===ze(Dt,"transform")&&Dt!==document;)Dt=Dt.parentNode;Dt!==document.body&&Dt!==document.documentElement?(Dt===document&&(Dt=$e()),t.top+=Dt.scrollTop,t.left+=Dt.scrollLeft):Dt=$e(),zt=He(Dt)}Oe(st=it.cloneNode(!0),a.ghostClass,!1),Oe(st,a.fallbackClass,!0),Oe(st,a.dragClass,!0),ze(st,"transition",""),ze(st,"transform",""),ze(st,"box-sizing","border-box"),ze(st,"margin",0),ze(st,"top",t.top),ze(st,"left",t.left),ze(st,"width",t.width),ze(st,"height",t.height),ze(st,"opacity","0.8"),ze(st,"position",jt?"absolute":"fixed"),ze(st,"zIndex","100000"),ze(st,"pointerEvents","none"),Zt.ghost=st,e.appendChild(st),ze(st,"transform-origin",wt/parseInt(st.style.width)*100+"% "+_t/parseInt(st.style.height)*100+"%")}},_onDragStart:function(e,t){var a=this,n=e.dataTransfer,i=a.options;at("dragStart",this,{evt:e}),Zt.eventCanceled?this._onDrop():(at("setupClone",this),Zt.eventCanceled||((pt=Ze(it)).removeAttribute("id"),pt.draggable=!1,pt.style["will-change"]="",this._hideClone(),Oe(pt,this.options.chosenClass,!1),Zt.clone=pt),a.cloneId=Vt((function(){at("clone",a),Zt.eventCanceled||(a.options.removeCloneOnHide||ot.insertBefore(pt,it),a._hideClone(),nt({sortable:a,name:"clone"}))})),!t&&Oe(it,i.dragClass,!0),t?(Ft=!0,a._loopId=setInterval(a._emulateDragOver,50)):(Ce(document,"mouseup",a._onDrop),Ce(document,"touchend",a._onDrop),Ce(document,"touchcancel",a._onDrop),n&&(n.effectAllowed="move",i.setData&&i.setData.call(a,n,it)),Ae(document,"drop",a),ze(it,"transform","translateZ(0)")),It=!0,a._dragStartId=Vt(a._dragStarted.bind(a,t,e)),Ae(document,"selectstart",a),St=!0,we&&ze(document.body,"user-select","none"))},_onDragOver:function(e){var t,a,n,i,r=this.el,s=e.target,o=this.options,l=o.group,c=Zt.active,p=gt===l,d=o.sort,f=xt||c,u=this,h=!1;if(!Nt){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=Fe(s,o.draggable,r,!0),I("dragOver"),Zt.eventCanceled)return h;if(it.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||u._ignoreWhileAnimating===s)return R(!1);if(Ft=!1,c&&!o.disabled&&(p?d||(n=rt!==ot):xt===this||(this.lastPutMode=gt.checkPull(this,c,it,e))&&l.checkPut(this,c,it,e))){if(i="vertical"===this._getDirection(e,s),t=je(it),I("dragOverValid"),Zt.eventCanceled)return h;if(n)return rt=ot,F(),this._hideClone(),I("revert"),Zt.eventCanceled||(lt?ot.insertBefore(it,lt):ot.appendChild(it)),R(!0);var m=Be(r,o.draggable);if(!m||function(e,t,a){var n=je(Be(a.el,a.options.draggable)),i=10;return t?e.clientX>n.right+i||e.clientX<=n.right&&e.clientY>n.bottom&&e.clientX>=n.left:e.clientX>n.right&&e.clientY>n.top||e.clientX<=n.right&&e.clientY>n.bottom+i}(e,i,this)&&!m.animated){if(m===it)return R(!1);if(m&&r===e.target&&(s=m),s&&(a=je(s)),!1!==Qt(ot,r,it,t,s,a,e,!!s))return F(),m&&m.nextSibling?r.insertBefore(it,m.nextSibling):r.appendChild(it),rt=r,E(),R(!0)}else if(m&&function(e,t,a){var n=je(Le(a.el,0,a.options,!0)),i=10;return t?e.clientX<n.left-i||e.clientY<n.top&&e.clientX<n.right:e.clientY<n.top-i||e.clientY<n.bottom&&e.clientX<n.left}(e,i,this)){var g=Le(r,0,o,!0);if(g===it)return R(!1);if(a=je(s=g),!1!==Qt(ot,r,it,t,s,a,e,!1))return F(),r.insertBefore(it,g),rt=r,E(),R(!0)}else if(s.parentNode===r){a=je(s);var x,b,k,y=it.parentNode!==r,v=!function(e,t,a){var n=a?e.left:e.top,i=a?e.right:e.bottom,r=a?e.width:e.height,s=a?t.left:t.top,o=a?t.right:t.bottom,l=a?t.width:t.height;return n===s||i===o||n+r/2===s+l/2}(it.animated&&it.toRect||t,s.animated&&s.toRect||a,i),w=i?"top":"left",_=Pe(s,"top","top")||Pe(it,"top","top"),S=_?_.scrollTop:void 0;if(Tt!==s&&(b=a[w],Et=!1,Ot=!v&&o.invertSwap||y),x=function(e,t,a,n,i,r,s,o){var l=n?e.clientY:e.clientX,c=n?a.height:a.width,p=n?a.top:a.left,d=n?a.bottom:a.right,f=!1;if(!s)if(o&&Ct<c*i){if(!Et&&(1===At?l>p+c*r/2:l<d-c*r/2)&&(Et=!0),Et)f=!0;else if(1===At?l<p+Ct:l>d-Ct)return-At}else if(l>p+c*(1-i)/2&&l<d-c*(1-i)/2)return function(e){return Xe(it)<Xe(e)?1:-1}(t);if((f=f||s)&&(l<p+c*r/2||l>d-c*r/2))return l>p+c/2?1:-1;return 0}(e,s,a,i,v?1:o.swapThreshold,null==o.invertedSwapThreshold?o.swapThreshold:o.invertedSwapThreshold,Ot,Tt===s),0!==x){var T=Xe(it);do{T-=x,k=rt.children[T]}while(k&&("none"===ze(k,"display")||k===st))}if(0===x||k===s)return R(!1);Tt=s,At=x;var A=s.nextElementSibling,C=!1,D=Qt(ot,r,it,t,s,a,e,C=1===x);if(!1!==D)return 1!==D&&-1!==D||(C=1===D),Nt=!0,setTimeout(Wt,30),F(),C&&!A?r.appendChild(it):s.parentNode.insertBefore(it,C?A:s),_&&Ye(_,0,S-_.scrollTop),rt=it.parentNode,void 0===b||Ot||(Ct=Math.abs(b-je(s)[w])),E(),R(!0)}if(r.contains(it))return R(!1)}return!1}function I(o,l){at(o,u,ue({evt:e,isOwner:p,axis:i?"vertical":"horizontal",revert:n,dragRect:t,targetRect:a,canSort:d,fromSortable:f,target:s,completed:R,onMove:function(a,n){return Qt(ot,r,it,t,a,je(a),e,n)},changed:E},l))}function F(){I("dragOverAnimationCapture"),u.captureAnimationState(),u!==f&&f.captureAnimationState()}function R(t){return I("dragOverCompleted",{insertion:t}),t&&(p?c._hideClone():c._showClone(u),u!==f&&(Oe(it,xt?xt.options.ghostClass:c.options.ghostClass,!1),Oe(it,o.ghostClass,!0)),xt!==u&&u!==Zt.active?xt=u:u===Zt.active&&xt&&(xt=null),f===u&&(u._ignoreWhileAnimating=s),u.animateAll((function(){I("dragOverAnimationComplete"),u._ignoreWhileAnimating=null})),u!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(s===it&&!it.animated||s===r&&!s.animated)&&(Tt=null),o.dragoverBubble||e.rootEl||s===document||(it.parentNode[Qe]._isOutsideThisEl(e.target),!t&&Ut(e)),!o.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),h=!0}function E(){ut=Xe(it),mt=Xe(it,o.draggable),nt({sortable:u,name:"change",toEl:r,newIndex:ut,newDraggableIndex:mt,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){Ce(document,"mousemove",this._onTouchMove),Ce(document,"touchmove",this._onTouchMove),Ce(document,"pointermove",this._onTouchMove),Ce(document,"dragover",Ut),Ce(document,"mousemove",Ut),Ce(document,"touchmove",Ut)},_offUpEvents:function(){var e=this.el.ownerDocument;Ce(e,"mouseup",this._onDrop),Ce(e,"touchend",this._onDrop),Ce(e,"pointerup",this._onDrop),Ce(e,"touchcancel",this._onDrop),Ce(document,"selectstart",this)},_onDrop:function(e){var t=this.el,a=this.options;ut=Xe(it),mt=Xe(it,a.draggable),at("drop",this,{evt:e}),rt=it&&it.parentNode,ut=Xe(it),mt=Xe(it,a.draggable),Zt.eventCanceled||(It=!1,Ot=!1,Et=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),ea(this.cloneId),ea(this._dragStartId),this.nativeDraggable&&(Ce(document,"drop",this),Ce(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),we&&ze(document.body,"user-select",""),ze(it,"transform",""),e&&(St&&(e.cancelable&&e.preventDefault(),!a.dropBubble&&e.stopPropagation()),st&&st.parentNode&&st.parentNode.removeChild(st),(ot===rt||xt&&"clone"!==xt.lastPutMode)&&pt&&pt.parentNode&&pt.parentNode.removeChild(pt),it&&(this.nativeDraggable&&Ce(it,"dragend",this),Kt(it),it.style["will-change"]="",St&&!It&&Oe(it,xt?xt.options.ghostClass:this.options.ghostClass,!1),Oe(it,this.options.chosenClass,!1),nt({sortable:this,name:"unchoose",toEl:rt,newIndex:null,newDraggableIndex:null,originalEvent:e}),ot!==rt?(ut>=0&&(nt({rootEl:rt,name:"add",toEl:rt,fromEl:ot,originalEvent:e}),nt({sortable:this,name:"remove",toEl:rt,originalEvent:e}),nt({rootEl:rt,name:"sort",toEl:rt,fromEl:ot,originalEvent:e}),nt({sortable:this,name:"sort",toEl:rt,originalEvent:e})),xt&&xt.save()):ut!==ft&&ut>=0&&(nt({sortable:this,name:"update",toEl:rt,originalEvent:e}),nt({sortable:this,name:"sort",toEl:rt,originalEvent:e})),Zt.active&&(null!=ut&&-1!==ut||(ut=ft,mt=ht),nt({sortable:this,name:"end",toEl:rt,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){at("nulling",this),ot=it=rt=st=lt=pt=ct=dt=bt=kt=St=ut=mt=ft=ht=Tt=At=xt=gt=Zt.dragged=Zt.ghost=Zt.clone=Zt.active=null,Mt.forEach((function(e){e.checked=!0})),Mt.length=yt=vt=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":it&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],a=this.el.children,n=0,i=a.length,r=this.options;n<i;n++)Fe(e=a[n],r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||Jt(e));return t},sort:function(e,t){var a={},n=this.el;this.toArray().forEach((function(e,t){var i=n.children[t];Fe(i,this.options.draggable,n,!1)&&(a[e]=i)}),this),t&&this.captureAnimationState(),e.forEach((function(e){a[e]&&(n.removeChild(a[e]),n.appendChild(a[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Fe(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var a=this.options;if(void 0===t)return a[e];var n=Ve.modifyOption(this,e,t);a[e]=void 0!==n?n:t,"group"===e&&Ht(a)},destroy:function(){at("destroy",this);var e=this.el;e[Qe]=null,Ce(e,"mousedown",this._onTapStart),Ce(e,"touchstart",this._onTapStart),Ce(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Ce(e,"dragover",this),Ce(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),Rt.splice(Rt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!dt){if(at("hideClone",this),Zt.eventCanceled)return;ze(pt,"display","none"),this.options.removeCloneOnHide&&pt.parentNode&&pt.parentNode.removeChild(pt),dt=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(dt){if(at("showClone",this),Zt.eventCanceled)return;it.parentNode!=ot||this.options.group.revertClone?lt?ot.insertBefore(pt,lt):ot.appendChild(pt):ot.insertBefore(pt,it),this.options.group.revertClone&&this.animate(it,pt),ze(pt,"display",""),dt=!1}}else this._hideClone()}},$t&&Ae(document,"touchmove",(function(e){(Zt.active||It)&&e.cancelable&&e.preventDefault()})),Zt.utils={on:Ae,off:Ce,css:ze,find:Me,is:function(e,t){return!!Fe(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},throttle:Ue,closest:Fe,toggleClass:Oe,clone:Ze,index:Xe,nextTick:Vt,cancelNextTick:ea,detectDirection:Xt,getChild:Le},Zt.get=function(e){return e[Qe]},Zt.mount=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Zt.utils=ue(ue({},Zt.utils),e.utils)),Ve.mount(e)}))},Zt.create=function(e,t){return new Zt(e,t)},Zt.version="1.15.0";var ta,aa,na,ia,ra,sa,oa=[],la=!1;function ca(){oa.forEach((function(e){clearInterval(e.pid)})),oa=[]}function pa(){clearInterval(sa)}var da=Ue((function(e,t,a,n){if(t.scroll){var i,r=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,o=t.scrollSensitivity,l=t.scrollSpeed,c=$e(),p=!1;aa!==a&&(aa=a,ca(),ta=t.scroll,i=t.scrollFn,!0===ta&&(ta=Ge(a,!0)));var d=0,f=ta;do{var u=f,h=je(u),m=h.top,g=h.bottom,x=h.left,b=h.right,k=h.width,y=h.height,v=void 0,w=void 0,_=u.scrollWidth,S=u.scrollHeight,T=ze(u),A=u.scrollLeft,C=u.scrollTop;u===c?(v=k<_&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),w=y<S&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(v=k<_&&("auto"===T.overflowX||"scroll"===T.overflowX),w=y<S&&("auto"===T.overflowY||"scroll"===T.overflowY));var D=v&&(Math.abs(b-r)<=o&&A+k<_)-(Math.abs(x-r)<=o&&!!A),I=w&&(Math.abs(g-s)<=o&&C+y<S)-(Math.abs(m-s)<=o&&!!C);if(!oa[d])for(var F=0;F<=d;F++)oa[F]||(oa[F]={});oa[d].vx==D&&oa[d].vy==I&&oa[d].el===u||(oa[d].el=u,oa[d].vx=D,oa[d].vy=I,clearInterval(oa[d].pid),0==D&&0==I||(p=!0,oa[d].pid=setInterval(function(){n&&0===this.layer&&Zt.active._onTouchMove(ra);var t=oa[this.layer].vy?oa[this.layer].vy*l:0,a=oa[this.layer].vx?oa[this.layer].vx*l:0;"function"==typeof i&&"continue"!==i.call(Zt.dragged.parentNode[Qe],a,t,e,ra,oa[this.layer].el)||Ye(oa[this.layer].el,a,t)}.bind({layer:d}),24))),d++}while(t.bubbleScroll&&f!==c&&(f=Ge(f,!1)));la=p}}),30),fa=function(e){var t=e.originalEvent,a=e.putSortable,n=e.dragEl,i=e.activeSortable,r=e.dispatchSortableEvent,s=e.hideGhostForTarget,o=e.unhideGhostForTarget;if(t){var l=a||i;s();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(c.clientX,c.clientY);o(),l&&!l.el.contains(p)&&(r("spill"),this.onSpill({dragEl:n,putSortable:a}))}};function ua(){}function ha(){}ua.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,a=e.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var n=Le(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),a&&a.animateAll()},drop:fa},ge(ua,{pluginName:"revertOnSpill"}),ha.prototype={onSpill:function(e){var t=e.dragEl,a=e.putSortable||this.sortable;a.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),a.animateAll()},drop:fa},ge(ha,{pluginName:"removeOnSpill"});Zt.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?Ae(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Ae(document,"pointermove",this._handleFallbackAutoScroll):t.touches?Ae(document,"touchmove",this._handleFallbackAutoScroll):Ae(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?Ce(document,"dragover",this._handleAutoScroll):(Ce(document,"pointermove",this._handleFallbackAutoScroll),Ce(document,"touchmove",this._handleFallbackAutoScroll),Ce(document,"mousemove",this._handleFallbackAutoScroll)),pa(),ca(),clearTimeout(Re),Re=void 0},nulling:function(){ra=aa=ta=la=sa=na=ia=null,oa.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var a=this,n=(e.touches?e.touches[0]:e).clientX,i=(e.touches?e.touches[0]:e).clientY,r=document.elementFromPoint(n,i);if(ra=e,t||this.options.forceAutoScrollFallback||ye||ke||we){da(e,this.options,r,t);var s=Ge(r,!0);!la||sa&&n===na&&i===ia||(sa&&pa(),sa=setInterval((function(){var r=Ge(document.elementFromPoint(n,i),!0);r!==s&&(s=r,ca()),da(e,a.options,r,t)}),10),na=n,ia=i)}else{if(!this.options.bubbleScroll||Ge(r,!0)===$e())return void ca();da(e,this.options,Ge(r,!1),!1)}}},ge(e,{pluginName:"scroll",initializeByDefault:!0})}),Zt.mount(ha,ua);var ma=Zt;class GroupSheet extends ActorSheet{constructor(e,t){super(e,t),this.inlineSheets=[]}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{classes:["fatex fatex-sheet sheet actor_group_overview actor_group_overview--front"],resizable:!0,template:"/systems/fatex/templates/actor/group.hbs",dragDrop:[{dropSelector:null}],scrollY:[".fatex-desk__content"]})}async getData(){const e={owner:this.actor.isOwner,options:this.options,editable:this.isEditable,isTemplateActor:this.actor.isTemplateActor,isEmptyActor:!this.actor.items.size,isToken:this.token&&!this.token.data.actorLink,config:CONFIG.FateX};if(e.actor=foundry.utils.duplicate(this.actor),e.data=e.actor,e.items=this.actor.items.map((e=>foundry.utils.duplicate(e))),e.items.sort(((e,t)=>(e.sort||0)-(t.sort||0))),"group"==this.actor.type&&"manual"==this.actor.system.groupType){const t=this.actor.items.filter((e=>{var t,a;return"tokenReference"===e.type&&e.system.scene===(null===(a=null===(t=game.scenes)||void 0===t?void 0:t.active)||void 0===a?void 0:a.id)})).map((e=>"tokenReference"===e.data.type?e.system.id:""));canvas.scene&&(e.availableTokens=canvas.scene.tokens.filter((e=>!e.isLinked&&!t.includes(e.id||""))))}return e}activateListeners(e){var t;super.activateListeners(e),e.find(".fatex__actor_group__createToken").on("click",(e=>this._onCreateTokenReference.call(this,e))),e.find(".fatex__actor_group__sheet__navigation a").on("click",(e=>this._onChangeGroupNavigation.call(this,e)));for(const a in CONFIG.FateX.itemClasses)null===(t=CONFIG.FateX.itemClasses[a])||void 0===t||t.activateActorSheetListeners(e,this);for(const t in CONFIG.FateX.sheetComponents.actor)CONFIG.FateX.sheetComponents.actor[t].activateListeners(e,this)}addSortableJSHandler(e){"group"==this.actor.type&&e.find(".fatex-js-actor-group-sheets").length&&("manual"==this.actor.system.groupType&&ma.create(e.find(".fatex-js-actor-group-sheets")[0],{animation:150,removeOnSpill:!0,onEnd:e=>this.sortInlineSheets.call(this,e),onSpill:e=>this.spillInlineSheet.call(this,e)}),ma.create(e.find(".fatex-js-actor-group-sheets")[0],{group:["groupSort",this.actor.id].join("-"),animation:150}))}async spillInlineSheet(e){e.item.dataset.id&&await this.actor.deleteEmbeddedDocuments("Item",[e.item.dataset.id])}async sortInlineSheets(e){const t=Array.from(e.to.children).map((e=>{var t;return null!==(t=e.dataset.id)&&void 0!==t?t:""})).map(((e,t)=>({_id:e,sort:1e5+t})));await this.actor.updateEmbeddedDocuments("Item",t)}_getHeaderButtons(){return super._getHeaderButtons().filter((e=>!["configure-token","configure-sheet"].includes(e.class)))}async close(e={}){for(const e of this.inlineSheets)delete e.actor.apps[e.appId];return super.close(e)}async _render(e=!1,t={}){if(await super._render(e,t),"group"!==this.actor.type)return;const a=ga(this.actor.system.groupType,this.actor);for(const e of a)"actorReference"===e.type?await this.renderInlineActor(e):"tokenReference"===e.type?await this.renderInlineToken(e):"combatantReference"===e.type&&await this.renderInlineCombatant(e);this.element&&this._scrollPositions&&this._scrollPositions[".fatex-desk__content"]&&(this.element.find(".fatex-desk__content")[0].scrollTop=this._scrollPositions[".fatex-desk__content"]),this.addSortableJSHandler(this.element.find(".window-content"))}async renderInlineActor(e){var t;const a=null===(t=game.actors)||void 0===t?void 0:t.find((t=>{var a;return t.id===(null===(a=e.data)||void 0===a?void 0:a.id)&&t.isVisibleByPermission}));if(!a)return;const n=new InlineActorSheetFate(a,{referenceID:e._id});await n.render(!0,{group:this}),this.inlineSheets.push(n)}async renderInlineToken(e){var t,a;const n=null===(t=game.scenes)||void 0===t?void 0:t.find((t=>{var a;return t.id===(null===(a=e.data)||void 0===a?void 0:a.scene)})),i=n.data.tokens.find((t=>{var a;return t._id===(null===(a=e.data)||void 0===a?void 0:a.id)}));if(!i)return;i.parent=n;const r=new Token(i),s=new InlineActorSheetFate(r.actor,{referenceID:null===(a=e.data)||void 0===a?void 0:a.id});await s.render(!0,{token:r,group:this}),this.inlineSheets.push(s)}async renderInlineCombatant(e){var t;if(!game.combats||!game.combats.active)return;const a=null===(t=game.scenes)||void 0===t?void 0:t.find((e=>{var t,a;return e.id===(null===(a=null===(t=game.combats)||void 0===t?void 0:t.active)||void 0===a?void 0:a.data.scene)})),n=game.combats.active.combatants.find((t=>{var a;return t.data._id===(null===(a=e.data)||void 0===a?void 0:a.id)})),i=a.data.tokens.find((e=>{var t;return e._id===(null===(t=null==n?void 0:n.token)||void 0===t?void 0:t.id)}));if(!i||!n||!n.visible)return;delete n.actor,i.parent=a;const r=new Token(i),s=new InlineActorSheetFate(r.actor,{combatant:n,referenceID:e.data.id});await s.render(!0,{token:r,group:this}),this.inlineSheets.push(s)}_createActorReference(e){var t;const a=fromUuidSync(e);if(this.actor.items.find((e=>"actorReference"===e.type&&e.system.id===a.id)))return;if("character"!==a.type)return;const n={name:["actorReference",a.id].join("-"),type:"actorReference",data:{id:null!==(t=a.id)&&void 0!==t?t:""}};this.actor.createEmbeddedDocuments("Item",[n])}_createActorReferencesFromFolder(e){(fromUuidSync(e).contents.filter((e=>e instanceof FateActor&&"character"===e.type))||[]).forEach((e=>{this._createActorReference(`Actor.${e.id}`||"")}))}_createTokenReference(e,t){if(this.actor.items.find((a=>"tokenReference"===a.type&&a.system.id===e&&a.system.scene===t)))return;const a={name:["tokenReference",t,e].join("-"),type:"tokenReference",data:{id:e,scene:t}};this.actor.createEmbeddedDocuments("Item",[a])}_onChangeGroupNavigation(e){e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget).parents(".app");t.removeClass(["actor_group_overview--front","actor_group_overview--back"]),t.addClass(`actor_group_overview--${e.currentTarget.dataset.show}`),t.find(".fatex__actor_group__sheet__navigation a").removeClass("active"),t.find(`.fatex__actor_group__sheet__navigation--${e.currentTarget.dataset.show}`).addClass("active")}_onCreateTokenReference(e){var t,a;e.preventDefault(),e.stopPropagation();const n=e.currentTarget.dataset;if(!game.actors)return;const i=game.actors.tokens,r=Object.values(i).find((e=>{var t;return(null===(t=null==e?void 0:e.token)||void 0===t?void 0:t.id)===n.tokenId}));r&&game.scenes&&this._createTokenReference(n.tokenId,(null===(a=null===(t=game.scenes)||void 0===t?void 0:t.active)||void 0===a?void 0:a.id)||"")}async _onDrop(e){var t;let a;try{a=TextEditor.getDragEventData(e)}catch(e){return!1}if("group"!=this.actor.type||"manual"!=this.actor.system.groupType)return null===(t=ui.notifications)||void 0===t||t.error(game.i18n.localize("FAx.ActorGroups.Notifications.ManualOnly")),!1;switch(a.type){case"Actor":return this._createActorReference(a.uuid);case"Folder":return this._createActorReferencesFromFolder(a.uuid);case"Item":return this._onDropItem(e,a)}}}function ga(e="manual",t){switch(e){case"scene":case"encounter":return[];default:return t.items.filter((e=>["actorReference","tokenReference"].includes(e.type))).map((e=>e.data)).sort(((e,t)=>(e.sort||0)-(t.sort||0)))}}function xa(e){var t,a,n,i;if("actorReference"===e.type){const n=null===(t=game.actors)||void 0===t?void 0:t.find((t=>{var a;return t.id===(null===(a=e.data)||void 0===a?void 0:a.id)}));return null!==(a=null==n?void 0:n.data.img)&&void 0!==a?a:CONST.DEFAULT_TOKEN}if("tokenReference"===e.type){const t=null===(n=game.scenes)||void 0===n?void 0:n.find((t=>{var a;return t.id===(null===(a=e.data)||void 0===a?void 0:a.scene)})),a=null==t?void 0:t.tokens.find((t=>{var a;return t.id===(null===(a=e.data)||void 0===a?void 0:a.id)}));return null!==(i=null==a?void 0:a.data.img)&&void 0!==i?i:CONST.DEFAULT_TOKEN}return CONST.DEFAULT_TOKEN}function ba(e){const t=Object.values(ui.windows).filter((e=>e instanceof GroupSheet));for(const a of t)"group"==a.actor.type&&a.actor.system.groupType==e&&a.render()}class FateActor extends Actor{static async createDialog(e,t={}){var a;return CONFIG.FateX.applications.templatePicker&&(CONFIG.FateX.applications.templatePicker.options.folder=null==e?void 0:e.folder),null===(a=CONFIG.FateX.applications.templatePicker)||void 0===a?void 0:a.render(!0)}static async _create(e,t={}){return e.token=e.token||{},foundry.utils.mergeObject(e.token,{vision:!0,dimSight:30,brightSight:0,actorLink:!0,disposition:1},{overwrite:!1}),foundry.utils.mergeObject(e.token,{img:CONST.DEFAULT_TOKEN},{overwrite:!0}),super.create(e,t)}render(e=!1,t){var a;super.render(e,t);for(const e in CONFIG.FateX.applications)null===(a=CONFIG.FateX.applications[e])||void 0===a||a.render()}get isTemplateActor(){return!!this.getFlag("fatex","isTemplateActor")}get visible(){return!this.isTemplateActor&&super.visible}get isVisibleByPermission(){return super.visible}get images(){if("group"!==this.data.type)return[];const e=[],t=ga(this.system.groupType,this);for(let a=0;a<4;a++)e.push(t[a]?xa(t[a]):CONST.DEFAULT_TOKEN);return e}}class HandlebarsHelpers{static registerHelpers(){Handlebars.registerHelper("JSONstringify",(function(e){return JSON.stringify(e)}))}}class TemplatePreloader{static async preloadHandlebarsTemplates(){return loadTemplates(["systems/fatex/templates/item/tokenReference-sheet.hbs","systems/fatex/templates/item/stunt-sheet.hbs","systems/fatex/templates/item/stress-sheet.hbs","systems/fatex/templates/item/skill-sheet.hbs","systems/fatex/templates/item/extra-sheet.hbs","systems/fatex/templates/item/consequence-sheet.hbs","systems/fatex/templates/item/aspect-sheet.hbs","systems/fatex/templates/item/actorReference-sheet.hbs","systems/fatex/templates/item/settings/setting-text.hbs","systems/fatex/templates/item/settings/setting-rank.hbs","systems/fatex/templates/item/settings/setting-input.hbs","systems/fatex/templates/item/settings/setting-editor.hbs","systems/fatex/templates/item/settings/setting-automation-skill-enable.hbs","systems/fatex/templates/item/settings/setting-automation-boxes.hbs","systems/fatex/templates/inline-sheet/character.hbs","systems/fatex/templates/components/stress.hbs","systems/fatex/templates/components/setup-actions.hbs","systems/fatex/templates/components/messages.hbs","systems/fatex/templates/components/item-header.hbs","systems/fatex/templates/components/item-footer.hbs","systems/fatex/templates/components/header.hbs","systems/fatex/templates/components/header-logo.hbs","systems/fatex/templates/components/copyright.hbs","systems/fatex/templates/components/consequences.hbs","systems/fatex/templates/components/config.hbs","systems/fatex/templates/components/conditions.hbs","systems/fatex/templates/components/aspects.hbs","systems/fatex/templates/components/artwork.hbs","systems/fatex/templates/components/app-header.hbs","systems/fatex/templates/components/app-footer.hbs","systems/fatex/templates/chat/roll.hbs","systems/fatex/templates/chat/chat-card.hbs","systems/fatex/templates/apps/template-actors.hbs","systems/fatex/templates/apps/template-actors-picker.hbs","systems/fatex/templates/apps/sheet-setup.hbs","systems/fatex/templates/actor/limited.hbs","systems/fatex/templates/actor/group.hbs","systems/fatex/templates/actor/character.hbs","systems/fatex/templates/actor/tabs/stunts.hbs","systems/fatex/templates/actor/tabs/skills.hbs","systems/fatex/templates/actor/tabs/extras.hbs","systems/fatex/templates/actor/tabs/bio.hbs"])}}class ItemSheetFate extends ItemSheet{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{classes:["fatex","fatex-sheet","fatex-sheet--item","sheet"],scrollY:[".fatex-desk__content"],width:575})}async getData(){var e;let t=super.getData();t.data=this.object.system,t.system=t.data,t.isOwnedBy=!!this.actor&&this.actor.name,t=await(null===(e=CONFIG.FateX.itemClasses[this.item.type])||void 0===e?void 0:e.getSheetData(t,this))||t;for(const e in CONFIG.FateX.sheetComponents.item)Object.prototype.hasOwnProperty.call(CONFIG.FateX.sheetComponents.item,e)&&(t=await CONFIG.FateX.sheetComponents.item[e].getSheetData(t,this));return t}get template(){return`systems/fatex/templates/item/${this.item.type}-sheet.hbs`}activateListeners(e){var t;super.activateListeners(e);for(const t in CONFIG.FateX.sheetComponents.item)Object.prototype.hasOwnProperty.call(CONFIG.FateX.sheetComponents.item,t)&&CONFIG.FateX.sheetComponents.item[t].activateListeners(e,this);null===(t=CONFIG.FateX.itemClasses[this.item.type])||void 0===t||t.activateListeners(e,this)}}class AspectSheet extends ItemSheetFate{}class ConsequenceSheet extends ItemSheetFate{}class ExtraSheet extends ItemSheetFate{}class SkillSheet extends ItemSheetFate{async getData(){const e=await super.getData(),t=game.settings.get("fatex","guildCodexMagicSystemEnabled");return e.magicSystemEnabled=t,e}}class StressSheet extends ItemSheetFate{}class StuntSheet extends ItemSheetFate{}class TemplateActorSettings extends FormApplication{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{title:game.i18n.localize("FAx.Settings.Templates.App.Title"),template:"/systems/fatex/templates/apps/template-actors.hbs",id:"template-actors",resizable:!0,classes:["fatex","fatex-sheet","fatex-sheet--app"],width:860})}async getData(){var e;const t=duplicate(null===(e=game.actors)||void 0===e?void 0:e.filter((e=>e.isTemplateActor)));return t.forEach((e=>{e.stress=e.items.filter((e=>"stress"===e.type)),e.aspects=e.items.filter((e=>"aspect"===e.type)),e.skills=e.items.filter((e=>"skill"===e.type)),e.consequences=e.items.filter((e=>"consequence"===e.type))})),{options:this.options,templateActors:t}}activateListeners(e){super.activateListeners(e),e.find(".fatex-js-create-template").on("click",(e=>this._createTemplate.call(this,e))),e.find(".fatex-js-delete-template").on("click",(e=>this._deleteTemplate.call(this,e))),e.find(".fatex-js-configure-template").on("click",(e=>this._configureTemplate.call(this,e))),e.find(".fatex-js-duplicate-template").on("click",(e=>this._duplicateTemplate.call(this,e)))}async _configureTemplate(e){var t,a;e.preventDefault(),e.stopPropagation();const n=e.currentTarget.dataset,i=null===(t=game.actors)||void 0===t?void 0:t.get(n.template);i&&(null===(a=i.sheet)||void 0===a||a.render(!0))}async _deleteTemplate(e){var t;e.preventDefault(),e.stopPropagation();const a=e.currentTarget.dataset,n=null===(t=game.actors)||void 0===t?void 0:t.get(a.template);n&&new Dialog({title:`${game.i18n.localize("FAx.Dialog.DocumentDelete")} ${n.name}`,content:game.i18n.localize("FAx.Dialog.DocumentDeleteText"),default:"submit",buttons:{cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("FAx.Dialog.Cancel"),callback:()=>null},submit:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("FAx.Dialog.Confirm"),callback:async()=>{var e;await n.delete(),this.render(!0),null===(e=CONFIG.FateX.applications.templatePicker)||void 0===e||e.render()}}}},{classes:["fatex","fatex-dialog"]}).render(!0)}async _createTemplate(e){var t;e.preventDefault();const a={name:game.i18n.localize("FAx.Settings.Templates.New"),type:"character",flags:{fatex:{isTemplateActor:!0}}},n=await FateActor._create(a,{renderSheet:!0});new SheetSetup(n,{}).render(!0),this.render(!0),null===(t=CONFIG.FateX.applications.templatePicker)||void 0===t||t.render()}async _duplicateTemplate(e){var t,a;e.preventDefault(),e.stopPropagation();const n=e.currentTarget.dataset,i=duplicate(null===(t=game.actors)||void 0===t?void 0:t.get(n.template));i&&(delete i._id,i.name=i.name+` (${game.i18n.localize("FAx.Settings.Templates.Copy")})`,await Actor.create(i,{renderSheet:!0}),this.render(!0),null===(a=CONFIG.FateX.applications.templatePicker)||void 0===a||a.render())}async _updateObject(){}}class TemplateActorPicker extends TemplateActorSettings{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{title:game.i18n.format("SIDEBAR.Create",{type:game.i18n.localize("DOCUMENT.Actor")}),template:"/systems/fatex/templates/apps/template-actors-picker.hbs",id:"template-actor-picker",resizable:!0,classes:["fatex","fatex-sheet","fatex-sheet--app"],width:860})}async getData(){const e=await super.getData();return e.AppTitle=game.i18n.format("SIDEBAR.Create",{type:game.i18n.localize("DOCUMENT.Actor")}),e}activateListeners(e){super.activateListeners(e),e.find(".fatex-js-choose-template").click((e=>this._chooseTemplate.call(this,e))),e.find(".fatex-js-empty-template").click((e=>this._emptyTemplate.call(this,e))),e.find(".fatex-js-template-header-button").click((()=>this._openSettings.call(this)))}async _openSettings(){var e;null===(e=CONFIG.FateX.applications.templateSettings)||void 0===e||e.render(!0)}async _emptyTemplate(e){e.preventDefault(),e.stopPropagation();const t={name:game.i18n.localize("FAx.Template.Picker.Empty"),type:"character"};this.options.folder&&(t.folder=this.options.folder);const a=await FateActor._create(t,{renderSheet:!0});new SheetSetup(a,{}).render(!0),await this.close()}async _chooseTemplate(e){var t,a;e.preventDefault(),e.stopPropagation();const n=e.currentTarget.dataset,i=foundry.utils.duplicate(null===(t=game.actors)||void 0===t?void 0:t.get(n.template)),r=null===(a=i.flags)||void 0===a?void 0:a.fatex;r.templateActor=i._id,delete i._id,delete r.isTemplateActor,delete i.img,this.options.folder&&(i.folder=this.options.folder),await FateActor._create(i,{renderSheet:!0}),await this.close()}async _updateObject(){}}class ReferenceSheet extends ItemSheetFate{}class FateScene extends Scene{_onUpdateEmbeddedDocuments(e,t,a,n,i){super._onUpdateEmbeddedDocuments(e,t,a,n,i),game.settings.get("fatex","enableAlphaFeatures")&&"Token"==e&&(ba("scene"),ba("manual"))}}class FateCombat extends Combat{_onDelete(e,t){super._onDelete(e,t),game.settings.get("fatex","enableAlphaFeatures")&&ba("encounter")}}class FateXSettings{static registerSettings(){game.settings.register("fatex","enableAlphaFeatures",{name:game.i18n.localize("FAx.Settings.System.Alpha.Name"),hint:game.i18n.localize("FAx.Settings.System.Alpha.Hint"),scope:"world",config:!0,type:Boolean,default:!1})}}class MagicDie extends foundry.dice.terms.FateDie{roll({minimize:e=!1,maximize:t=!1}={}){const a={result:void 0,active:!0};return a.result=e?-1:t?1:Math.ceil(CONFIG.Dice.randomUniform()*this.faces-2),-1===a.result&&(a.failure=!0),1===a.result&&(a.success=!0),a.count=1===a.result?2:a.result,this.results.push(a),a}}MagicDie.DENOMINATION="m";Hooks.once("init",(async()=>{console.log("FateX | Initializing Fate extended game system"),CONFIG.FateX=re,CONFIG.Actor.documentClass=FateActor,CONFIG.Item.documentClass=FateItem,CONFIG.Scene.documentClass=FateScene,CONFIG.Combat.documentClass=FateCombat,CONFIG.FateX.global.useMarkdown=!![...game.modules.values()].filter((e=>"markdown-editor"===e.id&&e.active)).length,FateXSettings.registerSettings(),HandlebarsHelpers.registerHelpers(),Actors.unregisterSheet("core",ActorSheet),Items.unregisterSheet("core",ItemSheet),Actors.registerSheet("FateX",CharacterSheet,{types:["character"],makeDefault:!0}),Actors.registerSheet("FateX",GroupSheet,{types:["group"],makeDefault:!0}),Items.registerSheet("FateX",StressSheet,{types:["stress"],makeDefault:!0}),Items.registerSheet("FateX",AspectSheet,{types:["aspect"],makeDefault:!0}),Items.registerSheet("FateX",ConsequenceSheet,{types:["consequence"],makeDefault:!0}),Items.registerSheet("FateX",SkillSheet,{types:["skill"],makeDefault:!0}),Items.registerSheet("FateX",StuntSheet,{types:["stunt"],makeDefault:!0}),Items.registerSheet("FateX",ExtraSheet,{types:["extra"],makeDefault:!0}),Items.registerSheet("FateX",ReferenceSheet,{types:["actorReference","tokenReference"],makeDefault:!0,label:"FAx.Sheets.Reference"}),await TemplatePreloader.preloadHandlebarsTemplates()})),class TemplateActorsFeature{static hooks(){Hooks.once("ready",(async()=>{CONFIG.FateX.applications.templateSettings=new TemplateActorSettings({}),CONFIG.FateX.applications.templatePicker=new TemplateActorPicker({})})),Hooks.on("renderSidebarTab",((e,t)=>{var a;console.log("DEREK: renderSidebarTab "+t);const n=$(t);if(!(e instanceof Settings&&(null===(a=game.user)||void 0===a?void 0:a.isGM)))return;n.find('button[data-action="configure"]').before(`\n                <button data-fatex="templates">\n                    <i class="fas fa-file-medical"></i> ${game.i18n.localize("FAx.Settings.Templates.Button")}\n                </button>\n            `),n.on("click",'button[data-fatex="templates"]',(()=>{var e;return null===(e=CONFIG.FateX.applications.templateSettings)||void 0===e?void 0:e.render(!0)}))}))}}.hooks(),class ActorGroupFeature{static hooks(){Hooks.on("renderActorDirectory",((e,t)=>{game.settings.get("fatex","enableAlphaFeatures")&&(this.addCreateGroupButton($(t)),this.styleGroupEntries($(t)))})),Hooks.on("updateActor",((e,t,a,n)=>{if(game.settings.get("fatex","enableAlphaFeatures")){const t=Object.values(ui.windows).filter((e=>e instanceof GroupSheet));for(const a of t){const t=a.inlineSheets.filter((t=>t.actor.id===e.id));for(const e of t)e.render()}}})),Hooks.on("canvasReady",((e,t,a,n)=>{game.settings.get("fatex","enableAlphaFeatures")&&ba("scene")}))}static addCreateGroupButton(e){var t;(null===(t=game.user)||void 0===t?void 0:t.isGM)&&!e.find(".fatex-header-actions").length&&(e.find(".header-actions").after(`\n                <div class="fatex-header-actions header-actions action-buttons flexrow">\n                    <button class="create-actor-group"><i class="fas fa-users"></i> ${game.i18n.localize("FAx.ActorGroups.New")}</button>\n                </div>\n        `),e.find(".folder").each(((e,t)=>{const a=$(t).data("folder-id"),n=$(t).find("h3").first().text();$(t).find(".folder-header").first().append(`<a class="create-folder-group" data-folder="${a}" data-groupname="${n}"> <i class="fas fa-user-friends fa-fw"></i></a>`)})),e.find("button.create-actor-group, a.create-folder-group").on("click",(e=>this._onClickCreateGroup.call(this,e))))}static styleGroupEntries(e){var t;((null===(t=game.actors)||void 0===t?void 0:t.filter((e=>"group"===e.type)))||[]).forEach((t=>{e.find(`.entity[data-entity-id=${t.id}]`).addClass("fatex__actorDirectory__entry").find(".entity-name").after('<i class="fas fa-users"></i> ')}))}static async _onClickCreateGroup(e){var t,a;e.stopPropagation();const n=e.currentTarget,i={name:null!==(t=n.dataset.groupname)&&void 0!==t?t:game.i18n.localize("FAx.ActorGroups.New"),type:"group",img:"/systems/fatex/assets/icons/group.svg",folder:null!==(a=n.dataset.folder)&&void 0!==a?a:void 0},r=await FateActor._create(i,{renderSheet:!0}),s=null==r?void 0:r.sheet;n.dataset.folder&&s._createActorReferencesFromFolder(n.dataset.folder)}}.hooks(),class ChatActionsFeature{static hooks(){Hooks.on("renderChatLog",((e,t,a)=>this.chatListeners($(t)))),Hooks.on("renderChatPopout",((e,t,a)=>this.chatListeners($(t)))),Hooks.once("init",(()=>{game.socket.on("system.fatex",(e=>{if("totalChanged"===e.type){const{messageId:t,rollIndex:a}=e;this.triggerTotalChangedAnimation(t,a,!1)}if("reroll"===e.type){const{messageId:t,rollIndex:a}=e;this.triggerRerollAnimation(t,a,!1,!0)}if("chatAction"===e.type){if(!game.user.isGM)return!1;if(!!game.users.filter((e=>e.isGM&&e.active)).some((e=>e.id<game.user.id)))return;const{action:t,messageId:a,rollIndex:n,shiftKey:i,userId:r}=e;this.handleChatAction(t,a,n,i,r)}}))}))}static triggerChatAnimation(e,t,a,n=!1){$("#chat-log").find(`.message[data-message-id="${t}"]`).find(`.fatex-chat__roll[data-roll-index="${a}"]`).addClass(`fatex-chat__roll--${e}`),n&&$("#chat-log").find(`.message[data-message-id="${t}"] button[data-action]`).prop("disabled",!0)}static chatListeners(e){e.on("click",".fatex-roll-actions button[data-action]",this._onChatCardAction.bind(this))}static async _onChatCardAction(e){e.preventDefault();const t=e.currentTarget,a=t.dataset.action,n=t.closest(".message").dataset.messageId,i=t.closest(".fatex-chat__roll").dataset.rollIndex;return game.user.isGM?await this.handleChatAction(a,n,i,e.shiftKey):game.users.filter((e=>e.isGM&&e.active)).length?game.socket.emit("system.fatex",{type:"chatAction",action:a,messageId:n,rollIndex:i,shiftKey:e.shiftKey,userId:game.user.id}):ui.notifications.warn(game.i18n.localize("FAx.ChatCard.NoGMConnected"))}static async handleChatAction(e,t,a,n,i=game.user.id){var r,s;const o=null===(r=game.messages)||void 0===r?void 0:r.get(t),l=null!==(s=null==o?void 0:o.getFlag("fatex","chatCard"))&&void 0!==s&&s;if(!l)return;const c=new FateChatCard(l);"reroll"===e&&(this.triggerRerollAnimation(t,a),await c.rolls[a].reroll(i,{shiftKey:n}),await c.updateMessage(),this.triggerTotalChangedAnimation(t,a)),"increase"===e&&(await c.rolls[a].increase(i,{shiftKey:n}),await c.updateMessage(),this.triggerTotalChangedAnimation(t,a))}static triggerTotalChangedAnimation(e,t,a=!0,n=!1){this.triggerChatAnimation("totalChanged",e,t,n),a&&game.socket.emit("system.fatex",{type:"totalChanged",messageId:e,rollIndex:t})}static triggerRerollAnimation(e,t,a=!0,n=!0){this.triggerChatAnimation("reroll",e,t,n,n),a&&game.socket.emit("system.fatex",{type:"reroll",messageId:e,rollIndex:t})}}.hooks(),class PrototypeTokenNameSyncFeature{static hooks(){Hooks.once("init",(()=>{game.settings.register("fatex","autoUpdateTokenName",{name:game.i18n.localize("FAx.Settings.autoUpdateTokenName.Name"),hint:game.i18n.localize("FAx.Settings.autoUpdateTokenName.Hint"),scope:"world",config:!0,default:!0,type:Boolean})})),Hooks.on("preUpdateActor",((e,t)=>{if(game.settings.get("fatex","autoUpdateTokenName")&&"name"in t){if(!e.isToken){if(e.prototypeToken.name!==e.name)return;t.prototypeToken={...t.prototypeToken,name:t.name}}if(e.isToken){const a=e.token.parent.tokens.get(e.token.id);if(a.name!==e.name)return;a.update({name:t.name})}}}))}}.hooks(),class MagicSystem{static hooks(){Hooks.once("init",(()=>{game.settings.register("fatex","guildCodexMagicSystemEnabled",{name:game.i18n.localize("FAx.Settings.magicSystemEnabled.Name"),hint:game.i18n.localize("FAx.Settings.magicSystemEnabled.Hint"),scope:"world",config:!0,default:!1,requiresReload:!0,type:Boolean}),game.settings.get("fatex","guildCodexMagicSystemEnabled")&&(CONFIG.Dice.terms.m=MagicDie)})),Hooks.once("diceSoNiceReady",(e=>{game.settings.get("fatex","guildCodexMagicSystemEnabled")&&e.addDicePreset({type:"dm",labels:["−"," ","+","−"," ","+"],values:{min:-1,max:1},fontScale:2,system:"standard"},"d6")}))}}.hooks(),class Roll2d6Feature{static hooks(){Hooks.once("init",(()=>{game.settings.register("fatex","enable2d6RollMode",{name:game.i18n.localize("FAx.Settings.enable2d6RollMode.Name"),hint:game.i18n.localize("FAx.Settings.enable2d6RollMode.Hint"),scope:"world",config:!0,default:!1,type:Boolean})}))}}.hooks()}();